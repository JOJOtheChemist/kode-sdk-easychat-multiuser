import{R as o,j as s}from"./index-CMJ4-CVj.js";import{l as z}from"./index-CA1CrNgP.js";function D(){return`${window.location.protocol}//${window.location.hostname}:3001`}function C({conversationId:g="demo"}){const[p,i]=o.useState([]),[l,y]=o.useState(""),[c,f]=o.useState("connecting"),[u,k]=o.useState(!1),[w,j]=o.useState(!1),x=o.useRef(null),m=o.useRef(null),N=o.useMemo(()=>D(),[]);o.useEffect(()=>{f("connecting"),k(!1);const t=z(N,{transports:["websocket"],path:"/socket.io",query:{conversation_id:g}});return m.current=t,t.on("connect",()=>{f("connected")}),t.on("disconnect",()=>{f("disconnected")}),t.on("oh_event",e=>{j(!1);const a=e.type,h=e.source??"system";if(a==="message"){const r=(e.args&&typeof e.args.content=="string"?e.args.content:"")||(typeof e.message=="string"?e.message:"");if(!r)return;i(d=>{const n=[...d],S=[...n].reverse().findIndex(_=>_.source===h&&_.kind==="message");if(S===-1||h==="user")return n.push({id:e.id??`${Date.now()}`,source:h,kind:"message",content:r}),n;const b=n.length-1-S;return n[b]={...n[b],content:`${n[b].content}${r}`},n});return}if(a==="tool_call_start"){const r=e.extras?.tool_name||e.action||"æœªçŸ¥å·¥å…·",d=e.args&&Object.keys(e.args).length>0?JSON.stringify(e.args,null,2):void 0;i(n=>[...n,{id:e.id??`${Date.now()}`,source:"agent",kind:"tool",content:`ğŸ”„ å·¥å…· ${r} å¼€å§‹æ‰§è¡Œ`,details:d}]);return}if(a==="tool_call_end"){const r=e.extras?.tool_name||e.action||"æœªçŸ¥å·¥å…·",d=e.extras?.result!==void 0?JSON.stringify(e.extras.result,null,2):void 0;i(n=>[...n,{id:e.id??`${Date.now()}`,source:"agent",kind:"tool",content:`âœ… å·¥å…· ${r} å®Œæˆ`,details:d}]);return}if(a==="agent_state_change"){(e.extras?.agent_state==="ready"||e.message==="Agent ready")&&k(!0),i(r=>[...r,{id:e.id??`${Date.now()}`,source:"system",kind:"status",content:e.message||"Agent çŠ¶æ€æ›´æ–°"}]);return}a==="error"&&i(r=>[...r,{id:e.id??`${Date.now()}`,source:"system",kind:"error",content:e.message||"å‘ç”ŸæœªçŸ¥é”™è¯¯"}])}),()=>{t.removeAllListeners(),t.disconnect(),m.current=null}},[N,g]),o.useEffect(()=>{x.current&&x.current.scrollTo({top:x.current.scrollHeight,behavior:"smooth"})},[p]);const $=o.useCallback(t=>{t.preventDefault();const e=l.trim();if(!(!e||!m.current||c!=="connected")){if(!u){i(a=>[...a,{id:`${Date.now()}`,source:"system",kind:"status",content:"Agent æ­£åœ¨åˆå§‹åŒ–ï¼Œè¯·ç¨å€™â€¦"}]);return}j(!0),m.current.emit("oh_user_action",{action:"message",args:{content:e,image_urls:[],file_urls:[],timestamp:new Date().toISOString()}}),i(a=>[...a,{id:`${Date.now()}`,source:"user",kind:"message",content:e}]),y("")}},[l,c,u]);return s.jsx("div",{className:"space-y-4",children:s.jsxs("section",{className:"rounded-lg border border-zinc-800 bg-[#161821] shadow-lg",children:[s.jsxs("header",{className:"flex items-center justify-between px-4 py-3 border-b border-zinc-800 gap-4",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:"text-sm text-zinc-400",children:"å½“å‰ä¼šè¯ ID"}),s.jsx("p",{className:"text-base font-medium text-white truncate",children:g})]}),s.jsxs("div",{className:"flex flex-col items-end gap-1 text-xs text-right",children:[s.jsx("span",{className:`text-sm ${c==="connected"?"text-emerald-400":c==="connecting"?"text-amber-400":"text-rose-400"}`,children:c==="connected"?"å·²è¿æ¥":c==="connecting"?"è¿æ¥ä¸­...":"å·²æ–­å¼€"}),c==="connected"&&s.jsx("span",{className:"text-zinc-400",children:u?"Agent å·²å°±ç»ªï¼Œå¯å‘é€æ¶ˆæ¯":"Agent æ­£åœ¨åˆå§‹åŒ–â€¦"})]})]}),s.jsxs("div",{ref:x,className:"h-[65vh] overflow-y-auto px-4 py-3 space-y-3 custom-scrollbar",children:[p.length===0&&s.jsx("p",{className:"text-sm text-zinc-500",children:"å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹å¯¹è¯å§ã€‚"}),p.map(t=>s.jsxs("article",{className:`rounded-md px-3 py-2 text-sm whitespace-pre-wrap ${t.kind==="error"?"bg-rose-600/10 border border-rose-600/30":t.kind==="status"?"bg-zinc-700/20 border border-zinc-600/30":t.source==="user"?"bg-sky-500/10 border border-sky-500/30":"bg-emerald-500/10 border border-emerald-500/30"}`,children:[s.jsx("header",{className:"mb-1 flex items-center justify-between text-xs uppercase tracking-wide text-zinc-400",children:s.jsxs("span",{children:[t.source==="user"?"ç”¨æˆ·":t.source==="agent"?"åŠ©æ‰‹":"ç³»ç»Ÿ",t.kind==="tool"&&" Â· å·¥å…·æ‰§è¡Œ",t.kind==="error"&&" Â· é”™è¯¯"]})}),s.jsx("p",{className:"text-sm leading-relaxed text-zinc-100",children:t.content}),t.details&&s.jsx("pre",{className:"mt-2 text-xs leading-relaxed text-zinc-300 bg-black/30 rounded-md px-2 py-1 overflow-x-auto",children:t.details})]},t.id))]}),s.jsx("footer",{className:"border-t border-zinc-800 px-4 py-3",children:s.jsxs("form",{onSubmit:$,className:"flex items-center gap-3",autoComplete:"off",children:[s.jsx("input",{className:"flex-1 rounded-md bg-[#10121a] border border-zinc-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-sky-500/60",value:l,onChange:t=>y(t.target.value),placeholder:"è¾“å…¥æ¶ˆæ¯ï¼Œå›è½¦å‘é€ç»™æ™ºè°±å¤§æ¨¡å‹"}),s.jsx("button",{type:"submit",disabled:w||c!=="connected"||!u||l.trim().length===0,className:"shrink-0 rounded-md bg-sky-500 px-4 py-2 text-sm font-medium text-white hover:bg-sky-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:w?"å‘é€ä¸­â€¦":"å‘é€"})]})})]})})}export{C};
