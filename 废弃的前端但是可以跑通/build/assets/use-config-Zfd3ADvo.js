import{R as J,G as I,j as R,H as f,D as $,y as m,J as z,F as X,K as L,n as x,k as Y,L as Z,S as tt,M as H,h as T,N as D,O as N,P as O,v as et,E as st,a as it,o as F}from"./open-hands-axios-ClrcRGkQ.js";import{a as y}from"./index-CMJ4-CVj.js";import{d as rt}from"./chunk-NISHYRIK-DZZPl_mu.js";var wt=class extends J{#i;#t;#a;#s;#e;#o;#n;constructor(t){super(),this.#n=!1,this.#o=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#s=t.client,this.#a=this.#s.getQueryCache(),this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#i=j(this.options),this.state=t.state??this.#i,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#e?.promise}setOptions(t){if(this.options={...this.#o,...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=j(this.options);e.data!==void 0&&(this.setData(e.data,{updatedAt:e.dataUpdatedAt,manual:!0}),this.#i=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#a.remove(this)}setData(t,e){const s=I(this.state.data,t,this.options);return this.#r({data:s,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),s}setState(t,e){this.#r({type:"setState",state:t,setStateOptions:e})}cancel(t){const e=this.#e?.promise;return this.#e?.cancel(t),e?e.then(R).catch(R):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#i)}isActive(){return this.observers.some(t=>f(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===$||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>m(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!z(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#e?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#e?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#a.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(this.#e&&(this.#n?this.#e.cancel({revert:!0}):this.#e.cancelRetry()),this.scheduleGc()),this.#a.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#r({type:"invalidate"})}async fetch(t,e){if(this.state.fetchStatus!=="idle"&&this.#e?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#e)return this.#e.continueRetry(),this.#e.promise}if(t&&this.setOptions(t),!this.options.queryFn){const r=this.observers.find(h=>h.options.queryFn);r&&this.setOptions(r.options)}const s=new AbortController,i=r=>{Object.defineProperty(r,"signal",{enumerable:!0,get:()=>(this.#n=!0,s.signal)})},a=()=>{const r=Y(this.options,e),l=(()=>{const o={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(o),o})();return this.#n=!1,this.options.persister?this.options.persister(r,l,this):r(l)},n=(()=>{const r={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:a};return i(r),r})();this.options.behavior?.onFetch(n,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==n.fetchOptions?.meta)&&this.#r({type:"fetch",meta:n.fetchOptions?.meta}),this.#e=X({initialPromise:e?.initialPromise,fn:n.fetchFn,onCancel:r=>{r instanceof L&&r.revert&&this.setState({...this.#t,fetchStatus:"idle"}),s.abort()},onFail:(r,h)=>{this.#r({type:"failed",failureCount:r,error:h})},onPause:()=>{this.#r({type:"pause"})},onContinue:()=>{this.#r({type:"continue"})},retry:n.options.retry,retryDelay:n.options.retryDelay,networkMode:n.options.networkMode,canRun:()=>!0});try{const r=await this.#e.start();if(r===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(r),this.#a.config.onSuccess?.(r,this),this.#a.config.onSettled?.(r,this.state.error,this),r}catch(r){if(r instanceof L){if(r.silent)return this.#e.promise;if(r.revert){if(this.state.data===void 0)throw r;return this.state.data}}throw this.#r({type:"error",error:r}),this.#a.config.onError?.(r,this),this.#a.config.onSettled?.(this.state.data,r,this),r}finally{this.scheduleGc()}}#r(t){const e=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...W(s.data,this.options),fetchMeta:t.meta??null};case"success":const i={...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=t.manual?i:void 0,i;case"error":const a=t.error;return{...s,error:a,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=e(this.state),x.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),this.#a.notify({query:this,type:"updated",action:t})})}};function W(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Z(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function j(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,s=e!==void 0,i=s?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:s?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var at=class extends tt{constructor(t,e){super(),this.options=e,this.#i=t,this.#r=null,this.#n=H(),this.bindMethods(),this.setOptions(e)}#i;#t=void 0;#a=void 0;#s=void 0;#e;#o;#n;#r;#y;#d;#f;#u;#c;#h;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),K(this.#t,this.options)?this.#l():this.updateResult(),this.#g())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Q(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Q(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#R(),this.#S(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,s=this.#t;if(this.options=this.#i.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof f(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#C(),this.#t.setOptions(this.options),e._defaulted&&!T(this.options,e)&&this.#i.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const i=this.hasListeners();i&&B(this.#t,s,this.options,e)&&this.#l(),this.updateResult(),i&&(this.#t!==s||f(this.options.enabled,this.#t)!==f(e.enabled,this.#t)||m(this.options.staleTime,this.#t)!==m(e.staleTime,this.#t))&&this.#v();const a=this.#b();i&&(this.#t!==s||f(this.options.enabled,this.#t)!==f(e.enabled,this.#t)||a!==this.#h)&&this.#m(a)}getOptimisticResult(t){const e=this.#i.getQueryCache().build(this.#i,t),s=this.createResult(e,t);return ot(this,s)&&(this.#s=s,this.#o=this.options,this.#e=this.#t.state),s}getCurrentResult(){return this.#s}trackResult(t,e){return new Proxy(t,{get:(s,i)=>(this.trackProp(i),e?.(i),i==="promise"&&!this.options.experimental_prefetchInRender&&this.#n.status==="pending"&&this.#n.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(s,i))})}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#i.defaultQueryOptions(t),s=this.#i.getQueryCache().build(this.#i,e);return s.fetch().then(()=>this.createResult(s,e))}fetch(t){return this.#l({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#l(t){this.#C();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(R)),e}#v(){this.#R();const t=m(this.options.staleTime,this.#t);if(D||this.#s.isStale||!N(t))return;const s=z(this.#s.dataUpdatedAt,t)+1;this.#u=O.setTimeout(()=>{this.#s.isStale||this.updateResult()},s)}#b(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#m(t){this.#S(),this.#h=t,!(D||f(this.options.enabled,this.#t)===!1||!N(this.#h)||this.#h===0)&&(this.#c=O.setInterval(()=>{(this.options.refetchIntervalInBackground||et.isFocused())&&this.#l()},this.#h))}#g(){this.#v(),this.#m(this.#b())}#R(){this.#u&&(O.clearTimeout(this.#u),this.#u=void 0)}#S(){this.#c&&(O.clearInterval(this.#c),this.#c=void 0)}createResult(t,e){const s=this.#t,i=this.options,a=this.#s,c=this.#e,n=this.#o,h=t!==s?t.state:this.#a,{state:l}=t;let o={...l},g=!1,u;if(e._optimisticResults){const d=this.hasListeners(),S=!d&&K(t,e),b=d&&B(t,s,e,i);(S||b)&&(o={...o,...W(l.data,t.options)}),e._optimisticResults==="isRestoring"&&(o.fetchStatus="idle")}let{error:P,errorUpdatedAt:A,status:v}=o;u=o.data;let _=!1;if(e.placeholderData!==void 0&&u===void 0&&v==="pending"){let d;a?.isPlaceholderData&&e.placeholderData===n?.placeholderData?(d=a.data,_=!0):d=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,d!==void 0&&(v="success",u=I(a?.data,d,e),g=!0)}if(e.select&&u!==void 0&&!_)if(a&&u===c?.data&&e.select===this.#y)u=this.#d;else try{this.#y=e.select,u=e.select(u),u=I(a?.data,u,e),this.#d=u,this.#r=null}catch(d){this.#r=d}this.#r&&(P=this.#r,u=this.#d,A=Date.now(),v="error");const E=o.fetchStatus==="fetching",w=v==="pending",U=v==="error",q=w&&E,k=u!==void 0,p={status:v,fetchStatus:o.fetchStatus,isPending:w,isSuccess:v==="success",isError:U,isInitialLoading:q,isLoading:q,data:u,dataUpdatedAt:o.dataUpdatedAt,error:P,errorUpdatedAt:A,failureCount:o.fetchFailureCount,failureReason:o.fetchFailureReason,errorUpdateCount:o.errorUpdateCount,isFetched:o.dataUpdateCount>0||o.errorUpdateCount>0,isFetchedAfterMount:o.dataUpdateCount>h.dataUpdateCount||o.errorUpdateCount>h.errorUpdateCount,isFetching:E,isRefetching:E&&!w,isLoadingError:U&&!k,isPaused:o.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:U&&k,isStale:M(t,e),refetch:this.refetch,promise:this.#n,isEnabled:f(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const d=C=>{p.status==="error"?C.reject(p.error):p.data!==void 0&&C.resolve(p.data)},S=()=>{const C=this.#n=p.promise=H();d(C)},b=this.#n;switch(b.status){case"pending":t.queryHash===s.queryHash&&d(b);break;case"fulfilled":(p.status==="error"||p.data!==b.value)&&S();break;case"rejected":(p.status!=="error"||p.error!==b.reason)&&S();break}}return p}updateResult(){const t=this.#s,e=this.createResult(this.#t,this.options);if(this.#e=this.#t.state,this.#o=this.options,this.#e.data!==void 0&&(this.#f=this.#t),T(e,t))return;this.#s=e;const s=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,a=typeof i=="function"?i():i;if(a==="all"||!a&&!this.#p.size)return!0;const c=new Set(a??this.#p);return this.options.throwOnError&&c.add("error"),Object.keys(this.#s).some(n=>{const r=n;return this.#s[r]!==t[r]&&c.has(r)})};this.#O({listeners:s()})}#C(){const t=this.#i.getQueryCache().build(this.#i,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#a=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#g()}#O(t){x.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#s)}),this.#i.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function nt(t,e){return f(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function K(t,e){return nt(t,e)||t.state.data!==void 0&&Q(t,e,e.refetchOnMount)}function Q(t,e,s){if(f(e.enabled,t)!==!1&&m(e.staleTime,t)!=="static"){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&M(t,e)}return!1}function B(t,e,s,i){return(t!==e||f(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&M(t,s)}function M(t,e){return f(e.enabled,t)!==!1&&t.isStaleByTime(m(e.staleTime,t))}function ot(t,e){return!T(t.getCurrentResult(),e)}var V=y.createContext(!1),ht=()=>y.useContext(V);V.Provider;function ut(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var ct=y.createContext(ut()),lt=()=>y.useContext(ct),dt=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},ft=t=>{y.useEffect(()=>{t.clearReset()},[t])},pt=({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:a})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(a&&t.data===void 0||st(s,[t.error,i])),yt=t=>{if(t.suspense){const s=a=>a==="static"?a:Math.max(a??1e3,1e3),i=t.staleTime;t.staleTime=typeof i=="function"?(...a)=>s(i(...a)):s(i),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},vt=(t,e)=>t.isLoading&&t.isFetching&&!e,bt=(t,e)=>t?.suspense&&e.isPending,G=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function mt(t,e,s){const i=ht(),a=lt(),c=it(),n=c.defaultQueryOptions(t);c.getDefaultOptions().queries?._experimental_beforeQuery?.(n),n._optimisticResults=i?"isRestoring":"optimistic",yt(n),dt(n,a),ft(a);const r=!c.getQueryCache().get(n.queryHash),[h]=y.useState(()=>new e(c,n)),l=h.getOptimisticResult(n),o=!i&&t.subscribed!==!1;if(y.useSyncExternalStore(y.useCallback(g=>{const u=o?h.subscribe(x.batchCalls(g)):R;return h.updateResult(),u},[h,o]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),y.useEffect(()=>{h.setOptions(n)},[n,h]),bt(n,l))throw G(n,h,a);if(pt({result:l,errorResetBoundary:a,throwOnError:n.throwOnError,query:c.getQueryCache().get(n.queryHash),suspense:n.suspense}))throw l.error;return c.getDefaultOptions().queries?._experimental_afterQuery?.(n,l),n.experimental_prefetchInRender&&!D&&vt(l,i)&&(r?G(n,h,a):c.getQueryCache().get(n.queryHash)?.promise)?.catch(R).finally(()=>{h.updateResult()}),n.notifyOnChangeProps?l:h.trackResult(l)}function gt(t,e){return mt(t,at)}class Rt{static async getModels(){const{data:e}=await F.get("/api/options/models");return e}static async getAgents(){const{data:e}=await F.get("/api/options/agents");return e}static async getSecurityAnalyzers(){const{data:e}=await F.get("/api/options/security-analyzers");return e}static async getConfig(){const{data:e}=await F.get("/api/options/config");return e}}const St=()=>{const{pathname:t}=rt();return t==="/accept-tos"},Ut=()=>{const t=St();return gt({queryKey:["config"],queryFn:Rt.getConfig,staleTime:1e3*60*5,gcTime:1e3*60*15,enabled:!t})};export{Rt as O,at as Q,gt as a,St as b,ht as c,lt as d,yt as e,dt as f,ft as g,G as h,pt as i,mt as j,wt as k,bt as s,Ut as u,vt as w};
