# ChatKit å‰ç«¯ + Kode-SDK åŽç«¯å¯¹æŽ¥æ–¹æ¡ˆ

> å®Œæ•´çš„æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£ï¼Œå°† OpenAI ChatKit å‰ç«¯ä¸Ž Kode-SDK åŽç«¯é›†æˆ

## ðŸ“š æ–‡æ¡£ç›®å½•

1. **[å‰ç«¯æž¶æž„åˆ†æž](./01-å‰ç«¯æž¶æž„åˆ†æž.md)**
   - ChatKit React ç»„ä»¶åˆ†æž
   - API é€šä¿¡æœºåˆ¶
   - å®¢æˆ·ç«¯å·¥å…·ç³»ç»Ÿ
   - æ•°æ®æµå’ŒçŠ¶æ€ç®¡ç†

2. **[å½“å‰åŽç«¯æž¶æž„åˆ†æž](./02-å½“å‰åŽç«¯æž¶æž„åˆ†æž.md)**
   - OpenAI ChatKit Server å®žçŽ°
   - FastAPI + Python æž¶æž„
   - Agent å’Œå·¥å…·ç³»ç»Ÿ
   - ChatKit åè®®è¦ç‚¹

3. **[Kode-SDK åŽç«¯èƒ½åŠ›åˆ†æž](./03-kode-sdkåŽç«¯èƒ½åŠ›åˆ†æž.md)**
   - Kode-SDK æ ¸å¿ƒç‰¹æ€§
   - Agent ç³»ç»Ÿå’Œäº‹ä»¶æœºåˆ¶
   - å†…ç½®å·¥å…·å’Œè‡ªå®šä¹‰å·¥å…·
   - ä¸Ž ChatKit çš„å¯¹æ¯”åˆ†æž

4. **[å¯¹æŽ¥æ–¹æ¡ˆè®¾è®¡](./04-å¯¹æŽ¥æ–¹æ¡ˆè®¾è®¡.md)**
   - æ•´ä½“æž¶æž„è®¾è®¡
   - é€‚é…å±‚è®¾è®¡
   - æŠ€æœ¯æ ˆé€‰æ‹©
   - å®žçŽ°æ­¥éª¤è§„åˆ’

5. **[TypeScript å®žçŽ°æ–¹æ¡ˆ](./05-TypeScriptå®žçŽ°æ–¹æ¡ˆ.md)** â­ æŽ¨è
   - å®Œæ•´ä»£ç å®žçŽ°
   - é¡¹ç›®ç»“æž„
   - æ ¸å¿ƒç»„ä»¶è¯¦è§£
   - éƒ¨ç½²å’Œæµ‹è¯•æŒ‡å—

## ðŸŽ¯ æ–¹æ¡ˆæ¦‚è¿°

### æ ¸å¿ƒç›®æ ‡

å°† **OpenAI ChatKit å‰ç«¯**ï¼ˆReact + ChatKit åè®®ï¼‰ä¸Ž **Kode-SDK åŽç«¯**ï¼ˆTypeScript Agent æ¡†æž¶ï¼‰æ— ç¼é›†æˆï¼Œå®žçŽ°ï¼š

âœ… **å‰ç«¯é›¶ä¿®æ”¹**ï¼šä¿æŒ ChatKit React ç»„ä»¶ä¸å˜
âœ… **åè®®é€‚é…**ï¼šè½¬æ¢ ChatKit åè®® â†” Kode-SDK äº‹ä»¶
âœ… **åŠŸèƒ½å¢žå¼º**ï¼šåˆ©ç”¨ Kode-SDK çš„æ–‡ä»¶ç³»ç»Ÿã€ä»£ç ç¼–è¾‘ç­‰é«˜çº§åŠŸèƒ½
âœ… **ä¼ä¸šçº§å­˜å‚¨**ï¼šä½¿ç”¨ Kode-SDK çš„æŒä¹…åŒ–å’Œæ£€æŸ¥ç‚¹æœºåˆ¶

### æž¶æž„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React å‰ç«¯ï¼ˆ@openai/chatkit-reactï¼‰â”‚
â”‚   - å¯¹è¯ç•Œé¢                          â”‚
â”‚   - ä¸»é¢˜åˆ‡æ¢                          â”‚
â”‚   - Facts å±•ç¤º                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ ChatKit åè®®ï¼ˆSSEï¼‰
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node.js + TypeScript é€‚é…å±‚        â”‚
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ ChatKit Protocol Adapter     â”‚  â”‚
â”‚   â”‚ - è§£æž ChatKit è¯·æ±‚          â”‚  â”‚
â”‚   â”‚ - SSE äº‹ä»¶æµè½¬æ¢             â”‚  â”‚
â”‚   â”‚ - å®¢æˆ·ç«¯å·¥å…·è°ƒç”¨å¤„ç†         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Kode-SDK API
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Kode-SDK Agent å±‚                  â”‚
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Agent ç®¡ç†                   â”‚  â”‚
â”‚   â”‚ - å¤šä¼šè¯ç®¡ç†                 â”‚  â”‚
â”‚   â”‚ - è‡ªåŠ¨çŠ¶æ€æ¢å¤               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ å·¥å…·ç³»ç»Ÿ                     â”‚  â”‚
â”‚   â”‚ - save_fact                  â”‚  â”‚
â”‚   â”‚ - switch_theme               â”‚  â”‚
â”‚   â”‚ - æ–‡ä»¶ç³»ç»Ÿå·¥å…·ï¼ˆå¯é€‰ï¼‰       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ æŒä¹…åŒ–å­˜å‚¨                   â”‚  â”‚
â”‚   â”‚ - JSONStoreï¼ˆä¼šè¯åŽ†å²ï¼‰      â”‚  â”‚
â”‚   â”‚ - Facts å­˜å‚¨                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Node.js 18+
- GLM API Keyï¼ˆæˆ–å…¶ä»–å…¼å®¹çš„ LLM APIï¼‰
- Git

### æ­¥éª¤ 1: åˆ›å»ºåŽç«¯é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir chatkit-kode-backend
cd chatkit-kode-backend

# åˆå§‹åŒ–é¡¹ç›®
npm init -y

# å®‰è£…ä¾èµ–
npm install @shareai-lab/kode-sdk fastify @fastify/cors dotenv

# å®‰è£…å¼€å‘ä¾èµ–
npm install -D typescript @types/node tsx
```

### æ­¥éª¤ 2: åˆ›å»ºé¡¹ç›®æ–‡ä»¶

æŒ‰ç…§ **[TypeScript å®žçŽ°æ–¹æ¡ˆ](./05-TypeScriptå®žçŽ°æ–¹æ¡ˆ.md)** ä¸­çš„ä»£ç åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

```
src/
â”œâ”€â”€ server.ts              # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ chatkit/
â”‚   â”œâ”€â”€ adapter.ts         # ChatKit é€‚é…å™¨
â”‚   â””â”€â”€ converter.ts       # äº‹ä»¶è½¬æ¢å™¨
â”œâ”€â”€ kode/
â”‚   â”œâ”€â”€ config.ts          # Kode-SDK é…ç½®
â”‚   â”œâ”€â”€ agent-manager.ts   # Agent ç®¡ç†å™¨
â”‚   â””â”€â”€ tools.ts           # è‡ªå®šä¹‰å·¥å…·
â””â”€â”€ storage/
    â””â”€â”€ facts-store.ts     # Facts å­˜å‚¨
```

### æ­¥éª¤ 3: é…ç½®çŽ¯å¢ƒå˜é‡

```bash
# åˆ›å»º .env æ–‡ä»¶
cat > .env << EOF
PORT=8001
HOST=0.0.0.0
FRONTEND_URL=http://localhost:5173
GLM_API_KEY=your-glm-api-key-here
GLM_BASE_URL=https://open.bigmodel.cn/api/paas/v4
EOF
```

### æ­¥éª¤ 4: å¯åŠ¨åŽç«¯

```bash
npm run dev
```

### æ­¥éª¤ 5: é…ç½®å‰ç«¯

åœ¨å‰ç«¯é¡¹ç›®çš„ `.env` æ–‡ä»¶ä¸­ï¼š

```bash
VITE_CHATKIT_API_URL=http://localhost:8001/chatkit
VITE_CHATKIT_API_DOMAIN_KEY=domain_pk_localhost_dev
```

### æ­¥éª¤ 6: å¯åŠ¨å‰ç«¯

```bash
cd /path/to/frontend
npm run dev
```

è®¿é—® http://localhost:5173 å³å¯ä½¿ç”¨ï¼

## ðŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | åŽŸ ChatKit åŽç«¯ | Kode-SDK åŽç«¯ |
|------|----------------|---------------|
| æµå¼å¯¹è¯ | âœ… | âœ… |
| å®¢æˆ·ç«¯å·¥å…·ï¼ˆä¸»é¢˜åˆ‡æ¢ï¼‰ | âœ… | âœ… |
| å®¢æˆ·ç«¯å·¥å…·ï¼ˆä¿å­˜ factsï¼‰ | âœ… | âœ… |
| ä¼šè¯æŒä¹…åŒ– | âš ï¸ å†…å­˜ | âœ… æ–‡ä»¶/Redis |
| æ–‡ä»¶æ“ä½œ | âŒ | âœ… å®Œæ•´æ”¯æŒ |
| ä»£ç ç¼–è¾‘ | âŒ | âœ… æ”¯æŒ |
| Bash å‘½ä»¤ | âŒ | âœ… æ”¯æŒ |
| å¤š Agent åä½œ | âŒ | âœ… æ”¯æŒ |
| è‡ªåŠ¨çŠ¶æ€æ¢å¤ | âŒ | âœ… æ”¯æŒ |
| å·¥å…·æ‰©å±•æ€§ | âš ï¸ éœ€è¦è‡ªå®šä¹‰ | âœ… ä¸°å¯Œçš„ API |

## ðŸ”‘ å…³é”®æŠ€æœ¯ç‚¹

### 1. åè®®è½¬æ¢

```
ChatKit SSE äº‹ä»¶ â†â†’ Kode-SDK äº‹ä»¶

text.delta          â†â†’ text_chunk
client_tool_call    â†â†’ å·¥å…·è°ƒç”¨ + å®¢æˆ·ç«¯é˜Ÿåˆ—
thread_item.done    â†â†’ message_complete
```

### 2. å®¢æˆ·ç«¯å·¥å…·æœºåˆ¶

Kode-SDK ä¸åŽŸç”Ÿæ”¯æŒå®¢æˆ·ç«¯å·¥å…·ï¼Œé€šè¿‡**å·¥å…·è°ƒç”¨é˜Ÿåˆ—**å®žçŽ°ï¼š

```typescript
// åœ¨å·¥å…· handler ä¸­
clientToolCallQueue.get(agentId).push({
  name: 'record_fact',
  arguments: { fact_id, fact_text }
});

// åœ¨äº‹ä»¶è½¬æ¢æ—¶å‘é€
yield formatSSE({
  type: 'client_tool_call',
  name: 'record_fact',
  arguments: { ... }
});
```

### 3. ä¼šè¯ç®¡ç†

```
thread_id (ChatKit) â†’ Agent ID (Kode-SDK)
- AgentManager ç»´æŠ¤æ˜ å°„
- è‡ªåŠ¨åˆ›å»º/æ¢å¤ Agent
- æ¯ä¸ª thread ç‹¬ç«‹çš„æ²™ç®±çŽ¯å¢ƒ
```

## ðŸ› ï¸ å¼€å‘è·¯çº¿å›¾

### Phase 1: MVPï¼ˆ1-2 å‘¨ï¼‰

- [x] åŸºç¡€æž¶æž„æ­å»º
- [x] ChatKit é€‚é…å™¨å®žçŽ°
- [x] save_fact å·¥å…·
- [x] switch_theme å·¥å…·
- [x] æµå¼å“åº”
- [ ] åŸºç¡€æµ‹è¯•

### Phase 2: å¢žå¼ºåŠŸèƒ½ï¼ˆ2-3 å‘¨ï¼‰

- [ ] Facts REST API
- [ ] é”™è¯¯å¤„ç†ä¼˜åŒ–
- [ ] æ—¥å¿—ç³»ç»Ÿ
- [ ] æ€§èƒ½ç›‘æŽ§
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•

### Phase 3: ç”Ÿäº§å°±ç»ªï¼ˆ2-3 å‘¨ï¼‰

- [ ] Redis å­˜å‚¨åŽç«¯
- [ ] è®¤è¯å’ŒæŽˆæƒ
- [ ] è¯·æ±‚é™æµ
- [ ] Docker å®¹å™¨åŒ–
- [ ] CI/CD æµç¨‹
- [ ] æ–‡æ¡£å®Œå–„

### Phase 4: é«˜çº§ç‰¹æ€§ï¼ˆé•¿æœŸï¼‰

- [ ] æ–‡ä»¶ä¸Šä¼ æ”¯æŒ
- [ ] å¤©æ°”æŸ¥è¯¢å·¥å…·
- [ ] ä»£ç æ‰§è¡Œæ²™ç®±
- [ ] å¤š Agent åä½œ
- [ ] å®žæ—¶åä½œç¼–è¾‘

## ðŸ“ æ³¨æ„äº‹é¡¹

### å®‰å…¨æ€§

âš ï¸ **ç”Ÿäº§çŽ¯å¢ƒå¿…é¡»ï¼š**
- å¯ç”¨ HTTPS
- æ·»åŠ è®¤è¯æœºåˆ¶
- å®žçŽ°è¯·æ±‚é™æµ
- æ²™ç®±ä¸¥æ ¼éš”ç¦»
- API Key å®‰å…¨å­˜å‚¨
- CORS ç­–ç•¥é…ç½®

### æ€§èƒ½

âš ï¸ **ä¼˜åŒ–å»ºè®®ï¼š**
- ä½¿ç”¨ Redis ç¼“å­˜
- Agent æ± åŒ–ç®¡ç†
- è¿žæŽ¥å¤ç”¨
- äº‹ä»¶æµä¼˜åŒ–
- å®šæœŸæ¸…ç†è¿‡æœŸä¼šè¯

### æ‰©å±•æ€§

âœ… **æ˜“äºŽæ‰©å±•ï¼š**
- æ–°å¢žè‡ªå®šä¹‰å·¥å…·
- æŽ¥å…¥ä¸åŒ LLM
- æ·»åŠ ä¸­é—´ä»¶
- è‡ªå®šä¹‰å­˜å‚¨åŽç«¯

## ðŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿Žæäº¤ Issue å’Œ PRï¼

## ðŸ“„ è®¸å¯è¯

MIT

## ðŸ”— ç›¸å…³é“¾æŽ¥

- [Kode-SDK GitHub](https://github.com/your-org/kode-sdk)
- [OpenAI ChatKit æ–‡æ¡£](https://platform.openai.com/docs/chatkit)
- [GLM API æ–‡æ¡£](https://open.bigmodel.cn/dev/api)

---

**æœ€åŽæ›´æ–°**: 2025-01-15

**ç»´æŠ¤è€…**: Your Team

**é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/your-org/chatkit-kode-adapter/issues)

