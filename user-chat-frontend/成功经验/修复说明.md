# SSE æµå¼å“åº”ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜åŸå› 

**åç«¯ä½¿ç”¨æ ‡å‡† SSE æ ¼å¼ï¼Œå‰ç«¯è§£æä¸æ­£ç¡®**

### åç«¯å‘é€æ ¼å¼

```
event: text
data: {"delta":"ä½ å¥½","sessionId":"morning_work"}

event: thinking
data: {"delta":"...","sessionId":"morning_work"}

```

### å‰ç«¯ä¹‹å‰çš„é”™è¯¯è§£æ

```javascript
// âŒ é”™è¯¯ï¼šåªè§£æ data è¡Œï¼Œä¸¢å¤±äº† event åç§°
if (line.startsWith('data: ')) {
  const data = JSON.parse(line.slice(6));
  if (data.event === 'message') { // data é‡Œæ²¡æœ‰ event å­—æ®µï¼
    ...
  }
}
```

### å‰ç«¯ç°åœ¨çš„æ­£ç¡®è§£æ

```javascript
// âœ… æ­£ç¡®ï¼šå…ˆè§£æ eventï¼Œå†è§£æ data
let currentEvent = '';

if (line.startsWith('event: ')) {
  currentEvent = line.slice(7).trim();
}
else if (line.startsWith('data: ')) {
  const data = JSON.parse(line.slice(6));
  
  // ä½¿ç”¨ currentEvent åˆ¤æ–­äº‹ä»¶ç±»å‹
  if (currentEvent === 'text' || currentEvent === 'thinking') {
    accumulatedContent += data.delta;
  }
}
```

---

## âœ… å·²ä¿®å¤

### ä¿®æ”¹æ–‡ä»¶
- `/Users/yeya/FlutterProjects/kode-sdk/user-chat-frontend/src/App.tsx`

### ä¿®å¤å†…å®¹
1. âœ… æ·»åŠ  `currentEvent` å˜é‡ä¿å­˜äº‹ä»¶ç±»å‹
2. âœ… åˆ†åˆ«è§£æ `event:` å’Œ `data:` è¡Œ
3. âœ… æ­£ç¡®å¤„ç†æ‰€æœ‰åç«¯äº‹ä»¶ç±»å‹

### æ”¯æŒçš„äº‹ä»¶ç±»å‹
- âœ… `text` - æ–‡æœ¬å†…å®¹ï¼ˆæµå¼ï¼‰
- âœ… `thinking` - æ€è€ƒå†…å®¹ï¼ˆæµå¼ï¼‰
- âœ… `tool_start` - å·¥å…·è°ƒç”¨å¼€å§‹
- âœ… `tool_end` - å·¥å…·è°ƒç”¨ç»“æŸ
- âœ… `complete` - å¯¹è¯å®Œæˆ
- âœ… `error` - é”™è¯¯ä¿¡æ¯

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åˆ·æ–°æµè§ˆå™¨

Vite å·²è‡ªåŠ¨çƒ­æ›´æ–°ä»£ç ï¼Œåˆ·æ–°é¡µé¢å³å¯ï¼š

```
http://localhost:8888
```

æŒ‰ `Cmd + R` (Mac) æˆ– `Ctrl + R` (Windows) åˆ·æ–°

### 2. å‘é€æµ‹è¯•æ¶ˆæ¯

åœ¨ `morning_work` ä¼šè¯ä¸­å‘é€ï¼š
```
ä½ å¥½å•Š
```

### 3. é¢„æœŸæ•ˆæœ

**æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰**åº”è¯¥çœ‹åˆ°ï¼š
```
[SSE] thinking { delta: 'ç”¨æˆ·', sessionId: 'morning_work' }
[SSE] thinking { delta: 'æ‰“æ‹›å‘¼', sessionId: 'morning_work' }
[SSE] text { delta: 'ä½ å¥½', sessionId: 'morning_work' }
[SSE] text { delta: 'ï¼', sessionId: 'morning_work' }
[SSE] complete { sessionId: 'morning_work' }
```

**èŠå¤©ç•Œé¢**åº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ¤– åŠ©æ‰‹
ä½ å¥½ï¼
```

æµå¼æ˜¾ç¤ºï¼ˆä¸€ä¸ªå­—ä¸€ä¸ªå­—å‡ºç°ï¼‰

### 4. æµ‹è¯•å·¥å…·è°ƒç”¨

å‘é€éœ€è¦è°ƒç”¨å·¥å…·çš„æ¶ˆæ¯ï¼š
```
ä»Šå¤©ä¸‹åˆ3ç‚¹åˆ°5ç‚¹å¼€ä¼š
```

**é¢„æœŸæ•ˆæœ**ï¼š
```
ğŸ”§ [å·¥å…·è°ƒç”¨] create_schedule
âœ… create_schedule å®Œæˆ (4838ms)
å·²ç»ä¸ºæ‚¨è®°å½•äº†æ—¥ç¨‹
```

---

## ğŸ“Š è°ƒè¯•ä¿¡æ¯

### æŸ¥çœ‹ SSE äº‹ä»¶æµ

1. æ‰“å¼€æµè§ˆå™¨ DevTools (F12)
2. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾
3. å‘é€æ¶ˆæ¯
4. è§‚å¯Ÿ `[SSE]` æ—¥å¿—

### æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

1. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
2. æ‰¾åˆ° `/api/chat` è¯·æ±‚
3. ç‚¹å‡»æŸ¥çœ‹ **Response** æ ‡ç­¾
4. å¯ä»¥çœ‹åˆ°å®æ—¶çš„ SSE äº‹ä»¶æµ

### æŸ¥çœ‹åç«¯æ—¥å¿—

```bash
tail -f /Users/yeya/FlutterProjects/kode-sdk/kode-sdk/server.log
```

---

## ğŸ‰ ä¿®å¤å®Œæˆ

ç°åœ¨å‰ç«¯å¯ä»¥æ­£ç¡®æ¥æ”¶å’Œæ˜¾ç¤ºæ‰€æœ‰ç±»å‹çš„æµå¼å“åº”äº†ï¼

**ç«‹å³æµ‹è¯•**: http://localhost:8888

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `SSEäº‹ä»¶ç±»å‹è¯´æ˜.md` - è¯¦ç»†çš„äº‹ä»¶ç±»å‹æ–‡æ¡£
- `é—®é¢˜æ’æŸ¥æ¸…å•.md` - é—®é¢˜è¯Šæ–­æŒ‡å—
- `ä½¿ç”¨æŒ‡å—.md` - å®Œæ•´ä½¿ç”¨æ–‡æ¡£
