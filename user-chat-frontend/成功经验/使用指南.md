# 用户多对话管理前端 - 使用指南

## 🎉 启动成功！

前端服务已经在 **http://localhost:8888** 成功启动！

## 📋 系统配置

| 项目 | 配置 |
|------|------|
| **前端端口** | 8888 |
| **后端端口** | 2500 |
| **用户ID** | user1 |
| **Agent ID** | schedule-assistant |
| **存储路径** | `/Users/yeya/FlutterProjects/kode-sdk/kode-sdk/.kode/user1/` |

## 🚀 快速开始

### 1. 启动后端服务

确保后端服务在 2500 端口运行：

```bash
# 检查后端是否运行
lsof -i :2500

# 如果没有运行，启动后端服务
cd /Users/yeya/FlutterProjects/kode-sdk/kode-sdk
# 运行你的后端启动命令
```

### 2. 访问前端界面

在浏览器中打开：**http://localhost:8888**

### 3. 开始使用

1. **查看现有对话**：左侧会显示两个预设的对话
   - `morning_work` (上午工作)
   - `afternoon_meeting` (下午会议)

2. **选择对话**：点击左侧会话列表中的任一对话

3. **发送消息**：在底部输入框输入消息并点击"发送"

4. **创建新对话**：点击左上角的"＋ 新建对话"按钮

## ✨ 功能特性

### 会话管理
- ✅ 显示所有对话会话
- ✅ 切换不同对话
- ✅ 创建新对话
- ✅ 实时消息计数

### 消息处理
- ✅ 流式 SSE 渲染
- ✅ 实时显示正在输入状态
- ✅ 工具调用可视化
- ✅ 错误处理和显示
- ✅ 消息时间戳

### 界面设计
- 🎨 现代化 UI
- 📱 响应式布局
- 🔵 用户消息（蓝色背景）
- 🟢 助手消息（灰色背景）
- ⚡ 流畅动画效果

## 🧪 测试场景

### 场景 1: 基础对话测试

1. 选择 `morning_work` 对话
2. 输入：`今天上午9点到12点写代码，完成了新功能`
3. 观察 SSE 流式响应

### 场景 2: 多对话测试

1. 在 `morning_work` 发送消息
2. 切换到 `afternoon_meeting`
3. 发送不同的消息
4. 验证两个对话的消息是否独立

### 场景 3: 新建对话测试

1. 点击"＋ 新建对话"
2. 输入对话名称（如：`evening_study`）
3. 在新对话中发送消息
4. 验证消息是否正确保存

## 📊 SSE 事件类型

前端会处理以下 SSE 事件：

| 事件类型 | 说明 | 前端行为 |
|---------|------|---------|
| `message` | AI 回复消息 | 追加到消息内容 |
| `progress` | 进度更新 | 追加到消息内容 |
| `tool` | 工具调用 | 显示工具调用信息（🔧） |
| `complete` | 对话完成 | 停止流式指示器 |
| `error` | 错误信息 | 显示错误消息（❌） |

## 🔍 调试技巧

### 查看网络请求

1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 发送消息
4. 查看 `/api/chat` 请求详情

### 查看 SSE 流

在 Network 标签中：
1. 找到 `/api/chat` 请求
2. 点击查看 Response
3. 可以看到实时的 SSE 事件流

### 查看前端日志

```bash
# 查看前端服务日志
cat /Users/yeya/FlutterProjects/kode-sdk/user-chat-frontend/frontend.log

# 实时监控日志
tail -f /Users/yeya/FlutterProjects/kode-sdk/user-chat-frontend/frontend.log
```

### 查看控制台输出

浏览器控制台会显示：
- SSE 解析错误（如果有）
- 网络请求错误
- 其他运行时错误

## 📁 数据存储结构

每个对话的数据会存储在：

```
/Users/yeya/FlutterProjects/kode-sdk/kode-sdk/.kode/user1/
├── morning_work/
│   ├── chat_history.json
│   └── agent_state.json
└── afternoon_meeting/
    ├── chat_history.json
    └── agent_state.json
```

验证存储：

```bash
# 查看所有对话
ls -la /Users/yeya/FlutterProjects/kode-sdk/kode-sdk/.kode/user1/

# 查看某个对话的文件
ls -la /Users/yeya/FlutterProjects/kode-sdk/kode-sdk/.kode/user1/morning_work/
```

## 🛠️ 常见问题

### Q: 前端无法连接后端？

**A:** 检查后端是否运行在 2500 端口：
```bash
lsof -i :2500
```

### Q: SSE 流式响应不工作？

**A:** 
1. 检查浏览器控制台是否有错误
2. 验证后端返回的是正确的 SSE 格式
3. 检查 Vite 代理配置是否正确

### Q: 创建的对话没有保存？

**A:** 
1. 检查后端日志
2. 验证存储目录权限
3. 确认后端正确处理了 sessionId

### Q: 消息显示乱码或格式错误？

**A:**
1. 检查后端返回的 JSON 格式
2. 查看浏览器控制台的解析错误
3. 验证 SSE data 格式是否正确

## 🔧 管理命令

### 启动前端

```bash
cd /Users/yeya/FlutterProjects/kode-sdk/user-chat-frontend
npm run dev
```

或使用启动脚本：

```bash
./start-frontend.sh
```

### 停止前端

```bash
# 找到进程
lsof -i :8888 | grep LISTEN

# 杀死进程
kill -9 <PID>
```

### 重新安装依赖

```bash
cd /Users/yeya/FlutterProjects/kode-sdk/user-chat-frontend
rm -rf node_modules package-lock.json
npm install
```

### 构建生产版本

```bash
npm run build
```

## 📖 API 请求示例

前端发送的请求格式：

```json
POST http://localhost:2500/api/chat
Content-Type: application/json

{
  "userId": "user1",
  "agentId": "schedule-assistant",
  "sessionId": "morning_work",
  "message": "今天上午9点到12点写代码，完成了新功能"
}
```

后端 SSE 响应格式：

```
data: {"event":"message","content":"好的"}

data: {"event":"tool","tool":"record_schedule"}

data: {"event":"progress","content":"正在记录日程..."}

data: {"event":"complete"}
```

## 🎯 下一步

1. ✅ 测试与现有后端的集成
2. 💡 根据需要添加更多功能：
   - 删除对话
   - 编辑对话名称
   - 导出对话记录
   - 搜索历史消息
   - 对话标签/分类

## 📞 技术支持

如有问题，请检查：
1. `/Users/yeya/FlutterProjects/kode-sdk/user-chat-frontend/README.md`
2. 浏览器控制台错误信息
3. 前端日志文件
4. 后端日志文件

---

**祝使用愉快！** 🎉

