# é—®é¢˜æ’æŸ¥æ¸…å•

## å¿«é€Ÿè¯Šæ–­æ­¥éª¤

### 1ï¸âƒ£ æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥å‰ç«¯ (8888)
lsof -i :8888

# æ£€æŸ¥åç«¯ (2500)
lsof -i :2500
```

âœ… ä¸¤ä¸ªæœåŠ¡éƒ½åº”è¯¥åœ¨è¿è¡Œ

---

### 2ï¸âƒ£ æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒConsole æ ‡ç­¾ï¼š

**æœŸæœ›çœ‹åˆ°**:
```
[SSE] thinking { delta: '...', sessionId: '...' }
[SSE] text { delta: '...', sessionId: '...' }
[SSE] tool_start { name: '...', input: {...} }
[SSE] tool_end { name: '...', duration: 1234 }
[SSE] complete {}
```

**å¦‚æœæ²¡æœ‰æ—¥å¿—**:
- è¯·æ±‚å¯èƒ½æ²¡æœ‰å‘é€æˆåŠŸ
- æ£€æŸ¥ Network æ ‡ç­¾

**å¦‚æœæœ‰é”™è¯¯**:
- è®°å½•é”™è¯¯ä¿¡æ¯
- æ£€æŸ¥è¯·æ±‚å‚æ•°

---

### 3ï¸âƒ£ Network é¢æ¿æ£€æŸ¥

æ‰“å¼€ Network æ ‡ç­¾ï¼š

1. **æ‰¾åˆ° `/api/chat` è¯·æ±‚**
   - çŠ¶æ€åº”è¯¥æ˜¯ `200`
   - Type åº”è¯¥æ˜¯ `eventsource` æˆ– `fetch`

2. **æŸ¥çœ‹ Headers**
   ```
   Request URL: http://localhost:8888/api/chat
   Request Method: POST
   Status Code: 200 OK
   Content-Type: text/event-stream
   ```

3. **æŸ¥çœ‹ Payload**
   ```json
   {
     "userId": "user1",
     "agentId": "schedule-assistant",
     "sessionId": "morning_work",
     "message": "ä½ å¥½å•Š"
   }
   ```

4. **æŸ¥çœ‹ Response (EventStream)**
   åº”è¯¥èƒ½çœ‹åˆ°å®æ—¶çš„ SSE äº‹ä»¶æµ

---

### 4ï¸âƒ£ åç«¯æ—¥å¿—æ£€æŸ¥

```bash
tail -50 /Users/yeya/FlutterProjects/kode-sdk/kode-sdk/server.log
```

**æœŸæœ›çœ‹åˆ°**:
```
[ç”¨æˆ· â†’ æ—¥ç¨‹åŠ©æ‰‹] ä¼šè¯: morning_work, æ¶ˆæ¯: ä½ å¥½å•Š
[è®¢é˜…] å¼€å§‹ Progress äº‹ä»¶æµç›‘å¬...
[think_chunk] å‘é€æ€è€ƒå†…å®¹ï¼Œé•¿åº¦: 9
[text_chunk_start] æ­£å¼å›å¤å¼€å§‹
[å¯¹è¯å®Œæˆ] å·¥å…·è°ƒç”¨æ¬¡æ•°: 0, åŸå› : completed
ğŸ”“ [è§£é”] ä¼šè¯ user1:morning_work å¤„ç†å®Œæˆ
```

**å¦‚æœæ²¡æœ‰æ—¥å¿—**:
- è¯·æ±‚å¯èƒ½æ²¡æœ‰åˆ°è¾¾åç«¯
- æ£€æŸ¥ä»£ç†é…ç½®

---

### 5ï¸âƒ£ å‰ç«¯æ—¥å¿—æ£€æŸ¥

```bash
tail -50 /Users/yeya/FlutterProjects/kode-sdk/user-chat-frontend/frontend.log
```

æŸ¥çœ‹æ˜¯å¦æœ‰ Vite é”™è¯¯æˆ–çƒ­æ›´æ–°æ—¥å¿—

---

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: å‘é€æ¶ˆæ¯åæ— å“åº”

**ç—‡çŠ¶**: ç‚¹å‡»å‘é€åï¼Œæ¶ˆæ¯æ˜¾ç¤º"æ­£åœ¨è¾“å…¥..."ï¼Œä½†ä¸€ç›´æ²¡æœ‰å›å¤

**æ£€æŸ¥**:
1. æµè§ˆå™¨æ§åˆ¶å°æœ‰é”™è¯¯å—ï¼Ÿ
2. Network é¢æ¿ä¸­è¯·æ±‚çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿ
3. åç«¯æ—¥å¿—æ˜¾ç¤ºæ”¶åˆ°è¯·æ±‚äº†å—ï¼Ÿ

**è§£å†³**:
- å¦‚æœ Network æ˜¾ç¤º `429`: ä¼šè¯è¢«é”å®šï¼Œç­‰å¾…å‡ ç§’åé‡è¯•
- å¦‚æœ Network æ˜¾ç¤º `500`: åç«¯é”™è¯¯ï¼ŒæŸ¥çœ‹åç«¯æ—¥å¿—
- å¦‚æœæ²¡æœ‰ `[SSE]` æ—¥å¿—: SSE è§£æå¤±è´¥ï¼Œæ£€æŸ¥ä»£ç 

---

### é—®é¢˜ 2: åªæ˜¾ç¤º"æ­£åœ¨è¾“å…¥..."

**ç—‡çŠ¶**: æ¶ˆæ¯å‘é€æˆåŠŸï¼Œä½†åªæ˜¾ç¤º"æ­£åœ¨è¾“å…¥..."ï¼Œæ²¡æœ‰å®é™…å†…å®¹

**åŸå› **: å¯èƒ½æ˜¯ï¼š
1. SSE äº‹ä»¶ç±»å‹ä¸åŒ¹é…
2. `delta` å­—æ®µä¸ºç©º
3. å‰ç«¯æ²¡æœ‰æ­£ç¡®ç´¯ç§¯å†…å®¹

**æ£€æŸ¥**:
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
console.log('[SSE]', currentEvent, data);
```

æŸ¥çœ‹æ˜¯å¦æœ‰ `text` æˆ– `thinking` äº‹ä»¶

---

### é—®é¢˜ 3: å·¥å…·è°ƒç”¨ä¸æ˜¾ç¤º

**ç—‡çŠ¶**: åç«¯æ—¥å¿—æ˜¾ç¤ºå·¥å…·è¢«è°ƒç”¨ï¼Œä½†å‰ç«¯æ²¡æœ‰æ˜¾ç¤º

**æ£€æŸ¥**:
1. æ˜¯å¦æœ‰ `[SSE] tool_start` æ—¥å¿—ï¼Ÿ
2. `accumulatedContent` æ˜¯å¦åŒ…å«å·¥å…·ä¿¡æ¯ï¼Ÿ

**è§£å†³**:
ç¡®ä¿å‰ç«¯æ­£ç¡®å¤„ç† `tool_start` å’Œ `tool_end` äº‹ä»¶

---

### é—®é¢˜ 4: è¯·æ±‚è¢«æ‹’ç» (429)

**ç—‡çŠ¶**: Network æ˜¾ç¤º `429 Too Many Requests`

**åŸå› **: ä¼šè¯è¢«é”å®šï¼ˆå¦ä¸€ä¸ªè¯·æ±‚æ­£åœ¨å¤„ç†ï¼‰

**è§£å†³**:
1. ç­‰å¾…å½“å‰è¯·æ±‚å®Œæˆ
2. æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰ "ğŸ”“ [è§£é”]"
3. å¦‚æœé•¿æ—¶é—´æœªè§£é”ï¼Œå¯èƒ½æ˜¯æ­»é”ï¼Œéœ€è¦é‡å¯åç«¯

---

### é—®é¢˜ 5: CORS é”™è¯¯

**ç—‡çŠ¶**: æ§åˆ¶å°æ˜¾ç¤º CORS ç›¸å…³é”™è¯¯

**åŸå› **: è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢

**è§£å†³**:
1. æ£€æŸ¥ Vite ä»£ç†é…ç½®
2. ç¡®ä¿ä½¿ç”¨ `/api/chat` è€Œä¸æ˜¯ `http://localhost:2500/api/chat`

---

## è°ƒè¯•å·¥å…·

### 1. å®æ—¶ç›‘æ§åç«¯æ—¥å¿—

```bash
tail -f /Users/yeya/FlutterProjects/kode-sdk/kode-sdk/server.log | grep -E "ç”¨æˆ·|SSE|å·¥å…·|å®Œæˆ|è§£é”"
```

### 2. æµ‹è¯•åç«¯ API

```bash
curl -X POST http://localhost:2500/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user1",
    "agentId": "schedule-assistant",
    "sessionId": "test_debug",
    "message": "æµ‹è¯•æ¶ˆæ¯"
  }'
```

### 3. æ£€æŸ¥ä¼šè¯æ–‡ä»¶

```bash
ls -la /Users/yeya/FlutterProjects/kode-sdk/kode-sdk/.kode/user1/morning_work/
```

---

## å®Œæ•´è¯Šæ–­è„šæœ¬

```bash
#!/bin/bash

echo "=== æœåŠ¡çŠ¶æ€ ==="
echo "å‰ç«¯ (8888):"
lsof -i :8888 | grep LISTEN
echo "åç«¯ (2500):"
lsof -i :2500 | grep LISTEN

echo ""
echo "=== åç«¯æœ€æ–°æ—¥å¿— ==="
tail -20 /Users/yeya/FlutterProjects/kode-sdk/kode-sdk/server.log

echo ""
echo "=== æµ‹è¯•åç«¯ API ==="
curl -X POST http://localhost:2500/api/chat \
  -H "Content-Type: application/json" \
  -d '{"userId":"user1","agentId":"schedule-assistant","sessionId":"debug_test","message":"ping"}' \
  2>/dev/null | head -20

echo ""
echo "=== ä¼šè¯ç›®å½• ==="
ls -la /Users/yeya/FlutterProjects/kode-sdk/kode-sdk/.kode/user1/
```

ä¿å­˜ä¸º `debug.sh`ï¼Œè¿è¡Œ: `chmod +x debug.sh && ./debug.sh`

---

**è®°ä½**: å¤§å¤šæ•°é—®é¢˜éƒ½æ˜¯ SSE äº‹ä»¶ç±»å‹ä¸åŒ¹é…æˆ–è§£æé”™è¯¯å¯¼è‡´çš„ï¼
