# 01-å‰ç«¯å¯¹è¯ç•Œé¢æ ¸å¿ƒç»„ä»¶æ€»ç»“

> æœ¬æ–‡æ¡£æ˜¯ Frontend AI å¯¹è¯ç•Œé¢çš„æ ¸å¿ƒç»„ä»¶åˆ†ææ€»ç»“

---

## ç›®å½•

1. [æ ¸å¿ƒç»„ä»¶å±‚æ¬¡](#1-æ ¸å¿ƒç»„ä»¶å±‚æ¬¡)
2. [å…³é”®ç»„ä»¶è¯´æ˜](#2-å…³é”®ç»„ä»¶è¯´æ˜)
3. [æ¶ˆæ¯å‘é€æµç¨‹](#3-æ¶ˆæ¯å‘é€æµç¨‹)
4. [çŠ¶æ€ç®¡ç†](#4-çŠ¶æ€ç®¡ç†)
5. [WebSocket é€šä¿¡](#5-websocket-é€šä¿¡)
6. [æ–‡ä»¶ä¸Šä¼ å¤„ç†](#6-æ–‡ä»¶ä¸Šä¼ å¤„ç†)
7. [å…³é”®æ–‡ä»¶æ¸…å•](#7-å…³é”®æ–‡ä»¶æ¸…å•)
8. [å¯åŠ¨è¯´æ˜](#8-å¯åŠ¨è¯´æ˜)

---

## 1. æ ¸å¿ƒç»„ä»¶å±‚æ¬¡

### 1.1 ç»„ä»¶æ ‘ç»“æ„

```
ChatInterface (ä¸»å¯¹è¯ç•Œé¢)
â””â”€â”€ InteractiveChatBox (äº¤äº’å¼èŠå¤©ç›’)
    â”œâ”€â”€ CustomChatInput (è‡ªå®šä¹‰èŠå¤©è¾“å…¥)
    â”‚   â””â”€â”€ ChatInputContainer (è¾“å…¥å®¹å™¨)
    â”‚       â”œâ”€â”€ ChatInputRow (è¾“å…¥è¡Œ)
    â”‚       â”‚   â”œâ”€â”€ ChatAddFileButton (æ·»åŠ æ–‡ä»¶æŒ‰é’® ğŸ“)
    â”‚       â”‚   â”œâ”€â”€ ChatInputField (è¾“å…¥æ¡† âœï¸ - æ ¸å¿ƒè¾“å…¥ç»„ä»¶!)
    â”‚       â”‚   â””â”€â”€ ChatSendButton (å‘é€æŒ‰é’® ğŸ“¤ - å‘é€æ¶ˆæ¯!)
    â”‚       â””â”€â”€ ChatInputActions (èŠå¤©æ“ä½œ)
    â””â”€â”€ GitControlBar (Git æ§åˆ¶æ )
```

### 1.2 ç»„ä»¶è·¯å¾„

| åºå· | ç»„ä»¶åç§° | æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|------|---------|---------|------|
| 1 | ChatInterface | `src/components/features/chat/chat-interface.tsx` | ä¸»å¯¹è¯ç•Œé¢ |
| 2 | InteractiveChatBox | `src/components/features/chat/interactive-chat-box.tsx` | äº¤äº’å¼èŠå¤©ç›’ |
| 3 | CustomChatInput | `src/components/features/chat/custom-chat-input.tsx` | è‡ªå®šä¹‰èŠå¤©è¾“å…¥ |
| 4 | ChatInputField | `src/components/features/chat/components/chat-input-field.tsx` | **æ¶ˆæ¯è¾“å…¥æ¡†** â­ |
| 5 | ChatSendButton | `src/components/features/chat/chat-send-button.tsx` | **å‘é€æŒ‰é’®** ğŸ“¤ |
| 6 | Messages | `src/components/features/chat/messages.tsx` | æ¶ˆæ¯åˆ—è¡¨ |

---

## 2. å…³é”®ç»„ä»¶è¯´æ˜

### 2.1 ChatInputField - æ¶ˆæ¯è¾“å…¥æ¡† â­

**è¿™æ˜¯ç”¨æˆ·è¾“å…¥æ¶ˆæ¯çš„æ ¸å¿ƒç»„ä»¶ï¼**

```tsx
// æ–‡ä»¶: src/components/features/chat/components/chat-input-field.tsx

<div
  ref={chatInputRef}
  className="chat-input bg-transparent text-white text-[16px]"
  contentEditable                    // â† å¯ç¼–è¾‘çš„ div (ä¸æ˜¯ textarea)
  data-placeholder="What do you want to build?"
  data-testid="chat-input"
  onInput={onInput}
  onPaste={onPaste}
  onKeyDown={onKeyDown}
  onFocus={onFocus}
  onBlur={onBlur}
/>
```

**ç‰¹ç‚¹**:
- ä½¿ç”¨ `contentEditable` divï¼ˆä¸æ˜¯ textareaï¼‰
- æ”¯æŒè‡ªåŠ¨é«˜åº¦è°ƒæ•´ï¼ˆæœ€å° 20pxï¼Œæœ€å¤§ 400pxï¼‰
- ç™½è‰²æ–‡å­—ï¼Œé€æ˜èƒŒæ™¯
- æ”¯æŒç²˜è´´ã€é”®ç›˜å¿«æ·é”®

### 2.2 ChatSendButton - å‘é€æŒ‰é’® ğŸ“¤

```tsx
// æ–‡ä»¶: src/components/features/chat/chat-send-button.tsx

<button
  type="button"
  className="rounded-full border border-white size-[35px]"
  data-testid="submit-button"
  onClick={handleSubmit}
  disabled={disabled}
>
  <ArrowUp color={disabled ? "#959CB2" : "white"} />
</button>
```

**ç‰¹ç‚¹**:
- 35x35px åœ†å½¢æŒ‰é’®
- å‘ä¸Šç®­å¤´å›¾æ ‡
- ç¦ç”¨çŠ¶æ€å˜ç°
- Hover æ•ˆæœ

### 2.3 ChatInterface - ä¸»å¯¹è¯ç•Œé¢

```tsx
// æ–‡ä»¶: src/components/features/chat/chat-interface.tsx

export function ChatInterface() {
  // 1. å¤„ç†æ¶ˆæ¯å‘é€
  const handleSendMessage = async (content, images, files) => {
    // éªŒè¯æ–‡ä»¶ã€è½¬æ¢å›¾ç‰‡ã€ä¸Šä¼ æ–‡ä»¶ã€å‘é€ WebSocket æ¶ˆæ¯
  };

  // 2. å¤„ç†åœæ­¢
  const handleStop = () => {
    send(generateAgentStateChangeEvent(AgentState.STOPPED));
  };

  return (
    <div>
      {/* æ¶ˆæ¯åˆ—è¡¨ */}
      <Messages messages={events} />
      
      {/* è¾“å…¥æ¡† */}
      <InteractiveChatBox onSubmit={handleSendMessage} onStop={handleStop} />
    </div>
  );
}
```

**æ ¸å¿ƒèŒè´£**:
1. ç®¡ç†æ•´ä¸ªå¯¹è¯ç•Œé¢çš„çŠ¶æ€
2. å¤„ç†æ¶ˆæ¯å‘é€é€»è¾‘ï¼ˆæ–‡ä»¶éªŒè¯ã€å›¾ç‰‡è½¬æ¢ã€WebSocket å‘é€ï¼‰
3. ç®¡ç†æ»šåŠ¨è¡Œä¸º
4. å¤„ç†é”™è¯¯æ˜¾ç¤º

---

## 3. æ¶ˆæ¯å‘é€æµç¨‹

### 3.1 å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥æ–‡æœ¬ï¼ˆChatInputFieldï¼‰
    â†“
ç”¨æˆ·ç‚¹å‡»å‘é€ï¼ˆChatSendButtonï¼‰æˆ–æŒ‰ Enter
    â†“
è§¦å‘ handleSubmit
    â†“
CustomChatInput.handleSubmit()
    â†“
InteractiveChatBox.handleSubmit()
    â†“
ChatInterface.handleSendMessage()
    â†“
ã€å¤„ç†æ­¥éª¤ã€‘
â”œâ”€ 1. éªŒè¯æ–‡ä»¶å¤§å° (validateFiles)
â”œâ”€ 2. è½¬æ¢å›¾ç‰‡ä¸º Base64 (convertImageToBase64)
â”œâ”€ 3. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ (uploadFiles)
â”œâ”€ 4. æ„é€ æ¶ˆæ¯ prompt
â””â”€ 5. é€šè¿‡ WebSocket å‘é€ (send(createChatMessage(...)))
    â†“
è®¾ç½®ä¹è§‚æ›´æ–° (setOptimisticUserMessage)
    â†“
UI ç«‹å³æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
    â†“
ç­‰å¾… WebSocket å“åº”
    â†“
æ¥æ”¶ AI å“åº”å¹¶æ¸²æŸ“
```

### 3.2 æ ¸å¿ƒä»£ç 

```typescript
// ç¬¬ 1 æ­¥: ç”¨æˆ·è¾“å…¥
// ChatInputField.tsx - contentEditable div

// ç¬¬ 2 æ­¥: è§¦å‘æäº¤
// æ–¹å¼ 1: ç‚¹å‡»å‘é€æŒ‰é’®
<ChatSendButton onClick={handleSubmit} />

// æ–¹å¼ 2: æŒ‰ Enter é”®
if (e.key === 'Enter' && !e.shiftKey) {
  handleSubmit();
}

// ç¬¬ 3 æ­¥: å¤„ç†æ¶ˆæ¯
const handleSendMessage = async (content, images, files) => {
  // 1. éªŒè¯
  const validation = validateFiles(allFiles);
  if (!validation.isValid) {
    displayErrorToast(`Error: ${validation.errorMessage}`);
    return;
  }
  
  // 2. å›¾ç‰‡è½¬ Base64
  const imageUrls = await Promise.all(
    images.map(img => convertImageToBase64(img))
  );
  
  // 3. æ–‡ä»¶ä¸Šä¼ 
  const { uploaded_files } = await uploadFiles({
    conversationId,
    files
  });
  
  // 4. æ„é€  prompt
  const filePrompt = `Files: ${uploadedFiles.join("\n\n")}`;
  const prompt = uploadedFiles.length > 0 
    ? `${content}\n\n${filePrompt}` 
    : content;
  
  // 5. WebSocket å‘é€
  send(createChatMessage(prompt, imageUrls, uploadedFiles, timestamp));
  
  // 6. ä¹è§‚æ›´æ–°
  setOptimisticUserMessage(content);
};
```

---

## 4. çŠ¶æ€ç®¡ç†

### 4.1 ä¸»è¦ Store

| åºå· | Store | ç®¡ç†å†…å®¹ | å…³é”®æ–¹æ³• |
|------|-------|---------|---------|
| 1 | useConversationStore | å¯¹è¯çŠ¶æ€ | `addImages`, `addFiles`, `clearAllFiles` |
| 2 | useAgentStore | Agent çŠ¶æ€ | `curAgentState`, `setCurrentAgentState` |
| 3 | useEventStore | äº‹ä»¶åˆ—è¡¨ | `events` (æ¶ˆæ¯å’ŒåŠ¨ä½œ) |
| 4 | useOptimisticUserMessageStore | ä¹è§‚æ›´æ–° | `optimisticUserMessage` |
| 5 | useErrorMessageStore | é”™è¯¯ä¿¡æ¯ | `errorMessage` |

### 4.2 Agent çŠ¶æ€æšä¸¾

```typescript
enum AgentState {
  INIT = "INIT",                          // åˆå§‹åŒ–
  LOADING = "LOADING",                    // åŠ è½½ä¸­
  RUNNING = "RUNNING",                    // è¿è¡Œä¸­
  STOPPED = "STOPPED",                    // å·²åœæ­¢
  AWAITING_USER_CONFIRMATION = "AWAITING_USER_CONFIRMATION",  // ç­‰å¾…ç¡®è®¤
  AWAITING_USER_INPUT = "AWAITING_USER_INPUT",                // ç­‰å¾…è¾“å…¥
  FINISHED = "FINISHED",                  // å·²å®Œæˆ
  ERROR = "ERROR"                         // é”™è¯¯
}
```

### 4.3 ç¦ç”¨é€»è¾‘

```typescript
// InteractiveChatBox.tsx
const isDisabled =
  curAgentState === AgentState.LOADING ||
  curAgentState === AgentState.AWAITING_USER_CONFIRMATION;
```

---

## 5. WebSocket é€šä¿¡

### 5.1 WebSocket å®¢æˆ·ç«¯

```typescript
// ä½¿ç”¨ useWsClient hook
const { send, isLoadingMessages } = useWsClient();

// å‘é€æ¶ˆæ¯
import { createChatMessage } from "#/services/chat-service";

send(createChatMessage(
  prompt,        // æ¶ˆæ¯å†…å®¹
  imageUrls,     // Base64 å›¾ç‰‡æ•°ç»„
  uploadedFiles, // æ–‡ä»¶è·¯å¾„æ•°ç»„
  timestamp      // æ—¶é—´æˆ³
));
```

### 5.2 æ¶ˆæ¯æ ¼å¼

**å‘é€æ¶ˆæ¯**:
```typescript
createChatMessage(
  prompt: string,
  imageUrls: string[],
  uploadedFiles: string[],
  timestamp: string
)
```

**æ¥æ”¶äº‹ä»¶**:
- Agent çŠ¶æ€å˜æ›´äº‹ä»¶
- æ¶ˆæ¯å“åº”äº‹ä»¶
- é”™è¯¯äº‹ä»¶
- å®Œæˆäº‹ä»¶

### 5.3 Agent æ§åˆ¶

```typescript
// åœæ­¢ Agent
import { generateAgentStateChangeEvent } from "#/services/agent-state-service";

send(generateAgentStateChangeEvent(AgentState.STOPPED));
```

---

## 6. æ–‡ä»¶ä¸Šä¼ å¤„ç†

### 6.1 æ–‡ä»¶ç±»å‹å¤„ç†

```typescript
// åˆ†ç±»æ–‡ä»¶
const validFiles = selectedFiles.filter(f => !isFileImage(f));   // æ™®é€šæ–‡ä»¶
const validImages = selectedFiles.filter(f => isFileImage(f));   // å›¾ç‰‡æ–‡ä»¶
```

### 6.2 å¤„ç†æµç¨‹

```typescript
const handleUpload = async (selectedFiles: File[]) => {
  // 1. éªŒè¯å’Œåˆ†ç±»
  const { validFiles, validImages } = validateAndFilterFiles(selectedFiles);
  
  // 2. æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  validFiles.forEach(file => addFileLoading(file.name));
  validImages.forEach(image => addImageLoading(image.name));
  
  // 3. å¤„ç†æ–‡ä»¶
  const [fileResults, imageResults] = await Promise.all([
    processFiles(validFiles),    // ä½¿ç”¨ FileReader
    processImages(validImages)   // è½¬æ¢ä¸º Base64
  ]);
  
  // 4. æ›´æ–°çŠ¶æ€
  addFiles(fileResults.successful);
  addImages(imageResults.successful);
  
  // 5. æ˜¾ç¤ºé”™è¯¯
  fileResults.failed.forEach(({ file, error }) => {
    displayErrorToast(`Failed: ${file.name}: ${error.message}`);
  });
};
```

### 6.3 æ–‡ä»¶ä¸Šä¼  API

```typescript
const { mutateAsync: uploadFiles } = useUploadFiles();

const { uploaded_files, skipped_files } = await uploadFiles({
  conversationId: params.conversationId!,
  files
});
```

---

## 7. å…³é”®æ–‡ä»¶æ¸…å•

### 7.1 æ ¸å¿ƒç»„ä»¶æ–‡ä»¶

| åºå· | æ–‡ä»¶è·¯å¾„ | ç»„ä»¶ | ä½œç”¨ |
|------|---------|------|------|
| 1 | `src/components/features/chat/chat-interface.tsx` | ChatInterface | ä¸»å¯¹è¯ç•Œé¢ |
| 2 | `src/components/features/chat/interactive-chat-box.tsx` | InteractiveChatBox | äº¤äº’å¼èŠå¤©ç›’ |
| 3 | `src/components/features/chat/custom-chat-input.tsx` | CustomChatInput | è‡ªå®šä¹‰è¾“å…¥ |
| 4 | `src/components/features/chat/components/chat-input-field.tsx` | ChatInputField | **è¾“å…¥æ¡†** â­ |
| 5 | `src/components/features/chat/chat-send-button.tsx` | ChatSendButton | **å‘é€æŒ‰é’®** ğŸ“¤ |
| 6 | `src/components/features/chat/messages.tsx` | Messages | æ¶ˆæ¯åˆ—è¡¨ |

### 7.2 çŠ¶æ€ç®¡ç†æ–‡ä»¶

| åºå· | æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|------|---------|------|
| 1 | `src/state/conversation-store.ts` | å¯¹è¯çŠ¶æ€ï¼ˆæ–‡ä»¶ã€å›¾ç‰‡ï¼‰ |
| 2 | `src/stores/agent-store.ts` | Agent çŠ¶æ€ |
| 3 | `src/stores/use-event-store.ts` | äº‹ä»¶å­˜å‚¨ |
| 4 | `src/stores/optimistic-user-message-store.ts` | ä¹è§‚æ›´æ–° |
| 5 | `src/stores/error-message-store.ts` | é”™è¯¯ä¿¡æ¯ |

### 7.3 æœåŠ¡æ–‡ä»¶

| åºå· | æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|------|---------|------|
| 1 | `src/services/chat-service.ts` | èŠå¤©æœåŠ¡ï¼ˆåˆ›å»ºæ¶ˆæ¯ï¼‰ |
| 2 | `src/services/agent-state-service.ts` | Agent çŠ¶æ€æœåŠ¡ |
| 3 | `src/context/ws-client-provider.tsx` | WebSocket å®¢æˆ·ç«¯ |

### 7.4 å·¥å…·æ–‡ä»¶

| åºå· | æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|------|---------|------|
| 1 | `src/utils/file-validation.ts` | æ–‡ä»¶éªŒè¯ |
| 2 | `src/utils/file-processing.ts` | æ–‡ä»¶å¤„ç† |
| 3 | `src/utils/convert-image-to-base-64.ts` | å›¾ç‰‡è½¬ Base64 |

### 7.5 è‡ªå®šä¹‰ Hooks

| åºå· | æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|------|---------|------|
| 1 | `src/hooks/chat/use-chat-input-logic.ts` | è¾“å…¥æ¡†é€»è¾‘ |
| 2 | `src/hooks/chat/use-file-handling.ts` | æ–‡ä»¶å¤„ç† |
| 3 | `src/hooks/chat/use-grip-resize.ts` | å¤§å°è°ƒæ•´ |
| 4 | `src/hooks/chat/use-chat-submission.ts` | æ¶ˆæ¯æäº¤ |
| 5 | `src/hooks/chat/use-chat-input-events.ts` | è¾“å…¥äº‹ä»¶ |

---

## 8. å¯åŠ¨è¯´æ˜

### 8.1 å¯åŠ¨å‘½ä»¤

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd /Users/yeya/FlutterProjects/kode-sdk/frontend

# Mock æ¨¡å¼å¯åŠ¨ï¼ˆæ— éœ€åç«¯ï¼‰
VITE_FRONTEND_PORT=3020 npm run dev:mock
```

### 8.2 è®¿é—®åœ°å€

**å¯¹è¯ç•Œé¢**: http://localhost:3020/conversations/1

æˆ–: http://localhost:3020/conversations/2

### 8.3 Mock æ¨¡å¼ç‰¹ç‚¹

#### âœ… å¯ç”¨åŠŸèƒ½
1. å®Œæ•´çš„å¯¹è¯ç•Œé¢ UI
2. æ¶ˆæ¯è¾“å…¥å’Œå‘é€
3. æ¨¡æ‹Ÿçš„å†å²æ¶ˆæ¯
4. æ–‡ä»¶ä¸Šä¼  UIï¼ˆä¸ä¼šçœŸæ­£ä¸Šä¼ ï¼‰
5. å‘é€æ¶ˆæ¯ä¼šæ”¶åˆ°æ¨¡æ‹Ÿå›å¤ï¼š"Hello!"

#### âš ï¸ å¯å¿½ç•¥çš„é”™è¯¯
- Posthog é”™è¯¯ (åˆ†æå·¥å…·)
- 404 config.js (Posthog é…ç½®)
- 401 flags (åŠŸèƒ½æ ‡å¿—)

### 8.4 Mock é…ç½®å·²ä¿®å¤

**ä¿®å¤æ–‡ä»¶**: `src/mocks/handlers.ts`

```typescript
// ä¿®å¤å‰: settings ä¸º nullï¼Œå¯¼è‡´é¡µé¢æ— æ³•æ¸²æŸ“
const MOCK_USER_PREFERENCES = {
  settings: null  // âŒ
};

// ä¿®å¤å: ä½¿ç”¨é»˜è®¤é…ç½®
const MOCK_USER_PREFERENCES = {
  settings: MOCK_DEFAULT_USER_SETTINGS  // âœ…
};
```

---

## 9. æ•°æ®æµæ€»ç»“

```
ã€ç”¨æˆ·äº¤äº’ã€‘
    â†“
ã€React ç»„ä»¶ã€‘ChatInputField (contentEditable div)
    â†“
ã€Event Handlersã€‘useChatInputEvents
    â†“
ã€State Updatesã€‘useConversationStore
    â†“
ã€Submission Logicã€‘useChatSubmission
    â†“
ã€API Layerã€‘handleSendMessage
    â”œâ”€ validateFiles()
    â”œâ”€ convertImageToBase64()
    â”œâ”€ uploadFiles()
    â””â”€ createChatMessage()
    â†“
ã€WebSocketã€‘useWsClient.send()
    â†“
ã€åç«¯å¤„ç†ã€‘(åœ¨çœŸå®ç¯å¢ƒä¸­)
    â†“
ã€WebSocket Responseã€‘
    â†“
ã€State Updatesã€‘
    â”œâ”€ useEventStore
    â””â”€ useAgentStore
    â†“
ã€UI Re-renderã€‘Messages ç»„ä»¶æ˜¾ç¤ºå“åº”
```

---

## 10. å…³é”®è¦ç‚¹

### 10.1 æ ¸å¿ƒå…¥å£
- **è¾“å…¥æ¡†**: `ChatInputField` (contentEditable div)
- **å‘é€æŒ‰é’®**: `ChatSendButton` (åœ†å½¢æŒ‰é’®)
- **ä¸»æ§åˆ¶å™¨**: `ChatInterface` (handleSendMessage)

### 10.2 æ¶ˆæ¯å‘é€
1. ç”¨æˆ·è¾“å…¥ â†’ ChatInputField
2. ç‚¹å‡»å‘é€ â†’ ChatSendButton
3. å¤„ç†é€»è¾‘ â†’ ChatInterface.handleSendMessage
4. WebSocket â†’ send(createChatMessage(...))

### 10.3 çŠ¶æ€ç®¡ç†
- å¯¹è¯çŠ¶æ€: `useConversationStore`
- Agent çŠ¶æ€: `useAgentStore`
- äº‹ä»¶åˆ—è¡¨: `useEventStore`
- ä¹è§‚æ›´æ–°: `useOptimisticUserMessageStore`

### 10.4 æ–‡ä»¶å¤„ç†
- å›¾ç‰‡ â†’ Base64 ç¼–ç 
- æ–‡ä»¶ â†’ ä¸Šä¼ æœåŠ¡å™¨è·å–è·¯å¾„
- è·¯å¾„åŒ…å«åœ¨æ¶ˆæ¯ prompt ä¸­å‘é€

---

## 11. åç»­å¯¹æ¥è¦ç‚¹

### 11.1 éœ€è¦å¯¹æ¥çš„éƒ¨åˆ†

| åºå· | é¡¹ç›® | è¯´æ˜ |
|------|------|------|
| 1 | WebSocket æ¶ˆæ¯æ ¼å¼ | ç¡®ä¿ä¸åç«¯æ ¼å¼ä¸€è‡´ |
| 2 | Agent çŠ¶æ€æ˜ å°„ | å‰ç«¯ AgentState ä¸åç«¯çŠ¶æ€å¯¹åº” |
| 3 | æ–‡ä»¶ä¸Šä¼ ç«¯ç‚¹ | åç«¯æä¾›æ–‡ä»¶ä¸Šä¼  API |
| 4 | äº‹ä»¶ç±»å‹å®šä¹‰ | OpenHandsAction å’Œ OpenHandsObservation |

### 11.2 å…³é”®æœåŠ¡

**éœ€è¦æŸ¥çœ‹çš„æ–‡ä»¶**:
1. `src/services/chat-service.ts` - æ¶ˆæ¯æ ¼å¼
2. `src/context/ws-client-provider.tsx` - WebSocket é…ç½®
3. `src/hooks/mutation/use-upload-files.ts` - æ–‡ä»¶ä¸Šä¼  API

---

## æ€»ç»“

Frontend çš„ AI å¯¹è¯ç•Œé¢æ˜¯ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ç»„ä»¶ç³»ç»Ÿï¼š

âœ… **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„ç»„ä»¶å±‚æ¬¡å’ŒèŒè´£åˆ†ç¦»  
âœ… **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ Zustand ç®¡ç†å…¨å±€çŠ¶æ€  
âœ… **ç”¨æˆ·ä½“éªŒ**: ä¹è§‚æ›´æ–°ã€æ‹–æ”¾ã€è‡ªåŠ¨è°ƒæ•´å¤§å°  
âœ… **æ€§èƒ½ä¼˜åŒ–**: React.memoã€æ‡’åŠ è½½  
âœ… **å¯ç»´æŠ¤æ€§**: è‡ªå®šä¹‰ hooks å°è£…é€»è¾‘  
âœ… **ç±»å‹å®‰å…¨**: TypeScript ç±»å‹å®šä¹‰  

**æ ¸å¿ƒæµç¨‹**: ç”¨æˆ·åœ¨ `ChatInputField` è¾“å…¥ â†’ ç‚¹å‡» `ChatSendButton` â†’ `handleSendMessage` å¤„ç† â†’ WebSocket å‘é€ â†’ æ˜¾ç¤ºå“åº”

ç°åœ¨å¯ä»¥åŸºäºè¿™ä¸ªæ¶æ„è¿›è¡Œåç«¯å¯¹æ¥æˆ–å‰ç«¯å®šåˆ¶å¼€å‘ï¼ğŸš€

