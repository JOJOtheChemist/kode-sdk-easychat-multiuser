
# ä¸ºä»€ä¹ˆå·¦è¾¹å¯ä»¥è¢«çœ‹åˆ°ï¼Œå³è¾¹ä¸å¯ä»¥ï¼Ÿ ğŸ¤”

## é—®é¢˜æè¿°

**å·¦è¾¹ï¼ˆfs_writeï¼‰**ï¼šäº‹åæ·»åŠ  `prompt`ï¼ŒAgent **èƒ½çœ‹åˆ°** âœ…
**å³è¾¹ï¼ˆcreate_schedules_batchï¼‰**ï¼šäº‹åæ·»åŠ  `prompt`ï¼ŒAgent **çœ‹ä¸åˆ°** âŒ

ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼ŸğŸ¤·â€â™‚ï¸

---

## ğŸ­ é€šä¿—æ¯”å–»ï¼šå¤å°æœº vs åŸä»¶ä¼ é€’

### å·¦è¾¹ï¼ˆfs_writeï¼‰- ä¼ é€’åŸä»¶ ğŸ“„

æƒ³è±¡ä¸€ä¸ª**ä¼ é€’åŸä»¶**çš„åœºæ™¯ï¼š

```
1. åˆ›å»ºä¸€ä»½æ–‡æ¡£ï¼ˆå·¥å…·å®ä¾‹ï¼‰
   const æ–‡æ¡£ = åˆ¶ä½œå·¥å…·("fs_write")
   
2. åœ¨æ–‡æ¡£ä¸Šè´´ä¾¿ç­¾ï¼ˆæ·»åŠ  promptï¼‰
   æ–‡æ¡£.prompt = "ä½¿ç”¨è¯´æ˜"
   
3. æŠŠæ–‡æ¡£æ”¾å…¥æ¡£æ¡ˆæŸœï¼ˆæ³¨å†Œåˆ° registryï¼‰
   æ¡£æ¡ˆæŸœ.å­˜å…¥("fs_write", () => æ–‡æ¡£)  â† æ³¨æ„ï¼šè¿”å›çš„æ˜¯ã€åŸä»¶ã€‘
   
4. Agent æ¥å€Ÿæ–‡æ¡£
   const å€Ÿåˆ°çš„æ–‡æ¡£ = æ¡£æ¡ˆæŸœ.å–å‡º("fs_write")
   â†’ æ‹¿åˆ°çš„æ˜¯ã€åŸä»¶ã€‘ï¼Œä¸Šé¢æœ‰ä¾¿ç­¾ âœ…
```

**å…³é”®**ï¼šæ¡£æ¡ˆæŸœé‡Œå­˜çš„æ˜¯**åŸä»¶çš„å¼•ç”¨**ï¼Œæ¯æ¬¡å–å‡ºéƒ½æ˜¯**åŒä¸€ä»½æ–‡æ¡£**ã€‚
æ‰€ä»¥ä½ è´´çš„ä¾¿ç­¾å½“ç„¶åœ¨ä¸Šé¢ï¼âœ…

---

### å³è¾¹ï¼ˆcreate_schedules_batchï¼‰- å¤å°æ–‡æ¡£ ğŸ“‹

æƒ³è±¡ä¸€ä¸ª**å¤å°æ–‡æ¡£**çš„åœºæ™¯ï¼š

```
1. åˆ›å»ºä¸€ä»½æ–‡æ¡£æ¨¡æ¿ï¼ˆå·¥å…·å®šä¹‰ï¼‰
   const æ¨¡æ¿ = {
     name: "create_schedules_batch",
     description: "...",
     // æ³¨æ„ï¼šæ¨¡æ¿é‡Œã€æ²¡æœ‰ã€‘prompt å­—æ®µ
   }
   
2. ç”¨æ¨¡æ¿åˆ¶ä½œæ–‡æ¡£ï¼ˆå·¥å…·å®ä¾‹ï¼‰
   const æ–‡æ¡£ = åˆ¶ä½œå·¥å…·(æ¨¡æ¿)
   
3. åœ¨æ–‡æ¡£ä¸Šè´´ä¾¿ç­¾ï¼ˆæ·»åŠ  promptï¼‰
   æ–‡æ¡£.prompt = "ä½¿ç”¨è¯´æ˜"
   
4. æŠŠã€æ¨¡æ¿ã€‘æ”¾å…¥æ¡£æ¡ˆæŸœï¼ˆæ³¨å†Œï¼‰
   æ¡£æ¡ˆæŸœ.å­˜å…¥("create_schedules_batch", () => {
     return åˆ¶ä½œå·¥å…·(æ¨¡æ¿)  â† æ³¨æ„ï¼šæ¯æ¬¡éƒ½ã€å¤å°ã€‘ä¸€ä»½æ–°æ–‡æ¡£
   })
   
5. Agent æ¥å€Ÿæ–‡æ¡£
   const å€Ÿåˆ°çš„æ–‡æ¡£ = æ¡£æ¡ˆæŸœ.å–å‡º("create_schedules_batch")
   â†’ æ‹¿åˆ°çš„æ˜¯ã€å¤å°ä»¶ã€‘ï¼Œæ˜¯ç”¨æ¨¡æ¿æ–°åšçš„ï¼Œæ²¡æœ‰ä¾¿ç­¾ âŒ
```

**å…³é”®**ï¼šæ¡£æ¡ˆæŸœé‡Œå­˜çš„æ˜¯**æ¨¡æ¿ + å¤å°æœº**ï¼Œæ¯æ¬¡å–å‡ºéƒ½**å¤å°ä¸€ä»½æ–°çš„**ã€‚
æ–°å¤å°çš„æ–‡æ¡£ä¸Šï¼Œå½“ç„¶æ²¡æœ‰ä½ ä¹‹å‰è´´çš„ä¾¿ç­¾ï¼âŒ

---

## ğŸ” ä»£ç å±‚é¢çš„è§£é‡Š

### å·¦è¾¹ - `tool()` å‡½æ•°

```typescript
// 1. åˆ›å»ºå®ä¾‹
export const FsWrite = tool({
  name: 'fs_write',
  description: '...',
  // ...
});

// 2. äº‹åæ·»åŠ  prompt
FsWrite.prompt = PROMPT;

// 3. tool() å†…éƒ¨çš„æ³¨å†Œé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
function tool(definition) {
  const toolInstance = { /* å·¥å…·å®ä¾‹ */ };
  
  // æ³¨å†Œï¼šè¿”å›åŒä¸€ä¸ªå®ä¾‹
  registry.register(definition.name, () => toolInstance);  // â† è¿”å›ã€åŸä»¶ã€‘
  
  return toolInstance;
}

// 4. Agent ä½¿ç”¨æ—¶
const tool = registry.create('fs_write');  
// â†’ å¾—åˆ°çš„æ˜¯ toolInstanceï¼ˆåŸä»¶ï¼‰ï¼Œæœ‰ prompt âœ…
```

---

### å³è¾¹ - `defineTool()` å‡½æ•°

```typescript
// 1. åˆ›å»ºå®ä¾‹
export const createSchedulesBatchTool = defineTool({
  name: 'create_schedules_batch',
  description: '...',
  // æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰ prompt å­—æ®µ
});

// 2. äº‹åæ·»åŠ  prompt
(createSchedulesBatchTool as any).prompt = PROMPT;

// 3. defineTool() å†…éƒ¨çš„æ³¨å†Œé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
function defineTool(def) {
  const toolInstance = { /* å·¥å…·å®ä¾‹ */ };
  
  // æ³¨å†Œï¼šè¿”å›ä¸€ä¸ªã€å¤å°ã€‘æ–°å®ä¾‹çš„å‡½æ•°
  registry.register(def.name, () => {
    return defineTool(def);  // â† ã€å¤å°ã€‘ä¸€ä»½æ–°çš„ï¼Œdef é‡Œæ²¡æœ‰ prompt
  });
  
  return toolInstance;
}

// 4. Agent ä½¿ç”¨æ—¶
const tool = registry.create('create_schedules_batch');
// â†’ è°ƒç”¨ defineTool(def) å¤å°äº†ä¸€ä»½æ–°å®ä¾‹
// â†’ æ–°å®ä¾‹æ˜¯æ ¹æ® def åˆ›å»ºçš„ï¼Œdef é‡Œæ²¡æœ‰ prompt âŒ
```

---

## ğŸ“Š å¯¹æ¯”è¡¨æ ¼

| ç»´åº¦ | å·¦è¾¹ï¼ˆfs_writeï¼‰ | å³è¾¹ï¼ˆcreate_schedules_batchï¼‰ |
|------|-----------------|-------------------------------|
| **ä½¿ç”¨å‡½æ•°** | `tool()` | `defineTool()` |
| **æ³¨å†Œæ–¹å¼** | `() => toolInstance` | `() => defineTool(def)` |
| **è¿”å›å†…å®¹** | åŸä»¶ï¼ˆåŒä¸€ä¸ªå¯¹è±¡ï¼‰ | å¤å°ä»¶ï¼ˆæ–°å¯¹è±¡ï¼‰ |
| **äº‹åæ·»åŠ  prompt** | âœ… æœ‰æ•ˆ | âŒ æ— æ•ˆ |
| **æ¯”å–»** | å›¾ä¹¦é¦†å€Ÿä¹¦ï¼ˆåŸä»¶ï¼‰ | å¤å°åº—å¤å°ï¼ˆå‰¯æœ¬ï¼‰ |

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ

### `tool()` - ç®€å•åœºæ™¯
- å·¥å…·é…ç½®ç®€å•ï¼Œä¸éœ€è¦åŠ¨æ€å‚æ•°
- å¯ä»¥ç›´æ¥è¿”å›åŒä¸€ä¸ªå®ä¾‹
- æ€§èƒ½æ›´å¥½ï¼ˆä¸ç”¨é‡å¤åˆ›å»ºï¼‰

### `defineTool()` - çµæ´»åœºæ™¯
- å·¥å…·å¯èƒ½éœ€è¦æ ¹æ®é…ç½®åŠ¨æ€åˆ›å»ºï¼ˆæ¯”å¦‚ task_run éœ€è¦ä¼ å…¥ templatesï¼‰
- æ‰€ä»¥è®¾è®¡æˆ"æ¯æ¬¡éƒ½é‡æ–°åˆ›å»º"ï¼Œå¯ä»¥ä¼ å…¥ä¸åŒçš„ config
- ä»£ä»·ï¼šäº‹åæ·»åŠ çš„å±æ€§ä¼šä¸¢å¤±

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæŠŠ prompt æ”¾åˆ°å®šä¹‰é‡Œï¼ˆæ¨èï¼‰âœ…

```typescript
// âŒ é”™è¯¯æ–¹å¼
export const createSchedulesBatchTool = defineTool({
  name: 'create_schedules_batch',
  description: DESCRIPTION,
  // æ²¡æœ‰ prompt
});
(createSchedulesBatchTool as any).prompt = PROMPT;  // ä¼šä¸¢å¤±

// âœ… æ­£ç¡®æ–¹å¼
export const createSchedulesBatchTool = defineTool({
  name: 'create_schedules_batch',
  description: DESCRIPTION,
  prompt: PROMPT,  // åœ¨è¿™é‡Œä¼ å…¥
});
```

### æ–¹æ¡ˆ2ï¼šæ”¹ç”¨ `tool()` å‡½æ•°ï¼ˆå¦‚æœä¸éœ€è¦åŠ¨æ€é…ç½®ï¼‰

```typescript
import { tool } from '../../../src';
import { z } from 'zod';

export const createSchedulesBatchTool = tool({
  name: 'create_schedules_batch',
  description: DESCRIPTION,
  parameters: z.object({
    date: z.string(),
    natural_language: z.string(),
    slot_interval: z.number().optional(),
  }),
  async execute(args, ctx) {
    // ...
  },
});

createSchedulesBatchTool.prompt = PROMPT;  // è¿™æ ·å°±å¯ä»¥
```

---

## ğŸ’¡ ä¸€å¥è¯æ€»ç»“

**å·¦è¾¹èƒ½çœ‹åˆ°**ï¼šå› ä¸º `tool()` æŠŠ**åŸä»¶**å­˜è¿›æ¡£æ¡ˆæŸœï¼Œä½ è´´çš„ä¾¿ç­¾è¿˜åœ¨ä¸Šé¢ã€‚

**å³è¾¹çœ‹ä¸åˆ°**ï¼šå› ä¸º `defineTool()` æŠŠ**å¤å°æœº**å­˜è¿›æ¡£æ¡ˆæŸœï¼Œæ¯æ¬¡å–å‡ºéƒ½æ˜¯**æ–°å¤å°çš„**ï¼Œä½ è´´åœ¨åŸä»¶ä¸Šçš„ä¾¿ç­¾å½“ç„¶ä¸åœ¨å¤å°ä»¶ä¸Šã€‚

**è§£å†³åŠæ³•**ï¼šæŠŠä¾¿ç­¾è´´åœ¨æ¨¡æ¿ä¸Šï¼ˆåœ¨å®šä¹‰æ—¶ä¼ å…¥ promptï¼‰ï¼Œè¿™æ ·æ¯æ¬¡å¤å°å‡ºæ¥çš„æ–‡æ¡£éƒ½æœ‰ä¾¿ç­¾ï¼

---

## ğŸ”§ æ£€æŸ¥ä½ çš„ä»£ç 

### å¿«é€Ÿæ£€æŸ¥æ–¹æ³•

1. æ‰¾åˆ°ä½ çš„å·¥å…·å®šä¹‰æ–‡ä»¶ï¼ˆ`index.ts`ï¼‰
2. çœ‹ç¬¬ä¸€è¡Œå¯¼å…¥ï¼š
   ```typescript
   import { tool } from '...'         // â† ç”¨çš„æ˜¯ tool()
   import { defineTool } from '...'   // â† ç”¨çš„æ˜¯ defineTool()
   ```
3. å¦‚æœæ˜¯ `defineTool()`ï¼Œæ£€æŸ¥ï¼š
   - âœ… prompt åœ¨ `defineTool({ ... prompt: PROMPT ... })` é‡Œ
   - âŒ prompt åœ¨å¤–é¢ `(tool as any).prompt = PROMPT` â†’ éœ€è¦ç§»è¿›å»

### æ‰¹é‡æ£€æŸ¥å‘½ä»¤

åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š

```bash
# æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨ defineTool ä½†äº‹åæ·»åŠ  prompt çš„æ–‡ä»¶
grep -r "defineTool" --include="*.ts" | grep -l "\.prompt = "
```

å¦‚æœæœ‰è¾“å‡ºï¼Œè¯´æ˜è¿™äº›æ–‡ä»¶éœ€è¦ä¿®å¤ã€‚

---

å¸Œæœ›è¿™ä»½è¯´æ˜è®©ä½ ç†è§£äº†ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼ğŸ‰

