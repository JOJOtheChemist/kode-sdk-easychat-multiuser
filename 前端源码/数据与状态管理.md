## React Query 数据层

- 全局客户端定义在 `frontend/src/query-client-config.ts`，统一处理成功/失败逻辑及 401 重试。
- 查询 Hook 命名为 `useXXX`，例如：
  - `hooks/query/use-config.ts`：获取后端配置（包含 APP_MODE、Feature Flags 等）。
  - `hooks/query/use-paginated-conversations.ts`：分页读取最近会话。
  - `hooks/query/use-get-diff.ts`：根据文件路径获取差异，用于右侧 diff 面板。
- Mutation Hook 位于 `hooks/mutation`，封装常用提交操作（发送消息、保存设置、上传文件等）。

## Zustand 全局状态

- `stores/`：新拆分的领域状态，如
  - `agent-store.ts`：追踪当前智能体状态（LOADING/RUNNING/PAUSED 等）。
  - `use-event-store.ts`：缓存 WebSocket 事件及其 UI 派生结果。
  - `optimistic-user-message-store.ts`：发送消息时的乐观更新。
- `state/`：历史遗留的综合 store，例如 `conversation-store.ts` 管理聊天面板 UI（右侧面板是否打开、上传的文件列表等）。
- 每个 store 通常暴露 `reset` 方法，便于路由切换时清理状态。

## 服务层（Services）

- `api/` 中的服务直接调用后端接口。
- `services/` 封装特定业务流程：
  - `agent-state-service.ts` 把 agent 状态变更打包为 WebSocket 事件。
  - `chat-service.ts` 规范化聊天消息格式。
  - `terminal-service.ts`、`observations.ts` 提供终端输出或观察结果的解析逻辑。
- 通过服务层可以复用复杂逻辑，避免在组件里堆积大量处理代码。

## 工具与常量

- `utils/` 提供字符串解析、路径拼接、toast、Feature Flag、模型列表等通用工具。
- `constants/` & `types/` 提供统一的枚举、类型约束，降低魔法字符串/字段拼写错误的风险。

## 推荐阅读顺序

1. `api/` + `hooks/query`：搞清楚数据从接口到前端的调用链。
2. `stores/` / `state/`：掌握全局状态的来源和重置时机。
3. `services/`：理解跨组件复用的业务逻辑如何封装。
4. 最后结合页面组件查看这些数据是如何驱动 UI 的。

