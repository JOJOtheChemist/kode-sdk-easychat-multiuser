import{r as m,p as t,R as u,t as C,v as P,x as K,w as Z,O as J,y as Q,i as X}from"./chunk-NISHYRIK-CKdEls7F.js";import{I as l}from"./declaration-B9eIPmUJ.js";import"./index-at5IPRPS.js";import{u as U}from"./use-is-authed-Dg_tgDAm.js";import{u as A,a as q,b as ee}from"./use-config-DZPclKuv.js";import{S as j}from"./all-hands-logo-Dof7MO6u.js";import{M as S}from"./modal-backdrop-cp3dlfku.js";import{M as O}from"./modal-body-BthUSAn0.js";import{B as _,u as te}from"./brand-button-BQs8JWFf.js";import{u as g}from"./useTranslation-DONB_giz.js";import{B as se,a as ne}from"./base-modal-DLway4p0.js";import{u as H}from"./use-save-settings-CJKB8nlH.js";import{h as k}from"./handle-capture-consent-DZaBHqCI.js";import{u as F}from"./use-settings-B2QUSrrJ.js";import{u as ae}from"./use-balance-sltT6ZpO.js";import{B as oe}from"./billing-service.api-Dq_SF9sA.js";import{d as ie,a as re}from"./custom-toast-handlers-fYPNAJaC.js";import{T as le}from"./Trans-CPaTqF-h.js";import{g as Y,L as E,s as ce,a as G}from"./local-storage-BKwHRhd9.js";import{D as de}from"./module-CWLbpm_7.js";import{o as ue}from"./open-hands-axios-BIuoB8bl.js";import{u as me}from"./use-should-show-user-features-Nu8pXKlT.js";import{u as he}from"./index-S5BalIfI.js";import{F as fe}from"./index-BDUzCKOA.js";import{S as pe}from"./close-bbjPMB7Q.js";import{c as v,i as Ee}from"./utils-BVnsmU2z.js";import{i as ge}from"./i18next-Lgj2Bm8L.js";import"./preload-helper-BXl3LOEh.js";import"./option-service.api-CTPg1Fmy.js";import"./index-DWiKAxKp.js";import"./use-user-providers-P0hmd5MI.js";import"./bundle-mjs-0JNfDbnS.js";const xe=(e,s,n)=>{const o=`${s.hostname==="localhost"?s.protocol:"https:"}//${s.host}/oauth/keycloak/callback`;let r;n?r=`https://${n.replace(/^https?:\/\//,"")}`:(r=s.hostname.replace(/(^|\.)staging\.all-hands\.dev$/,"$1auth.staging.all-hands.dev").replace(/(^|\.)app\.all-hands\.dev$/,"auth.app.all-hands.dev").replace(/(^|\.)localhost$/,"auth.staging.all-hands.dev"),r===s.hostname&&s.hostname!=="localhost"&&(r=`auth.${s.hostname}`),r=`https://${r}`);const c="openid email profile",h=s.search?"&":"?",i=`${s.href.replace(/\/$/,"")}${h}login_method=${e}`;return`${r}/realms/allhands/protocol/openid-connect/auth?client_id=allhands&kc_idp_hint=${e}&response_type=code&redirect_uri=${encodeURIComponent(o)}&scope=${encodeURIComponent(c)}&state=${encodeURIComponent(i)}`},p=e=>e.appMode==="saas"?xe(e.identityProvider,new URL(window.location.href),e.authUrl):null,_e=e=>p({appMode:e.appMode,identityProvider:"github",authUrl:e.authUrl}),Ne=e=>m.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},m.createElement("path",{d:"M12 2.25C6.624 2.25 2.25 6.624 2.25 12C2.25 16.376 5.115 20.073 9.057 21.428C9.563 21.514 9.747 21.211 9.747 20.95C9.747 20.713 9.738 19.991 9.738 19.153C7 19.713 6.4 18.45 6.4 18.45C5.952 17.387 5.328 17.084 5.328 17.084C4.476 16.487 5.387 16.487 5.387 16.487C6.328 16.546 6.85 17.481 6.85 17.481C7.675 18.862 9.057 18.487 9.776 18.226C9.867 17.603 10.133 17.179 10.419 16.94C8.287 16.713 6.05 15.85 6.05 11.9C6.05 10.837 6.4 9.975 6.859 9.3C6.759 9.05 6.45 8.038 6.95 6.65C6.95 6.65 7.734 6.4 9.738 7.775C10.483 7.534 11.25 7.413 12.017 7.413C12.784 7.413 13.55 7.534 14.296 7.775C16.3 6.4 17.084 6.65 17.084 6.65C17.584 8.038 17.275 9.05 17.175 9.3C17.634 9.975 17.984 10.837 17.984 11.9C17.984 15.85 15.747 16.7 13.615 16.94C13.975 17.237 14.296 17.813 14.296 18.7C14.296 19.975 14.287 20.6 14.287 20.95C14.287 21.211 14.471 21.514 14.977 21.428C18.919 20.073 21.784 16.376 21.784 12C21.784 6.624 17.376 2.25 12 2.25Z",fill:"currentColor"})),Ae=e=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"97 99 186 182",...e},m.createElement("defs",null,m.createElement("style",null,".cls-1{fill:currentColor;}")),m.createElement("g",{id:"LOGO"},m.createElement("path",{className:"cls-1",d:"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z"}))),we=e=>m.createElement("svg",{role:"img",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",...e},m.createElement("title",null,"Bitbucket"),m.createElement("path",{d:"M.778 1.213a.768.768 0 00-.768.892l3.263 19.81c.084.5.515.868 1.022.873H19.95a.772.772 0 00.77-.646l3.27-20.03a.768.768 0 00-.768-.891zM14.52 15.53H9.522L8.17 8.466h7.561z"}));function Ie({githubAuthUrl:e,appMode:s,authUrl:n,providersConfigured:a}){const{t:o}=g(),r=p({appMode:s||null,identityProvider:"gitlab",authUrl:n}),c=p({appMode:s||null,identityProvider:"bitbucket",authUrl:n}),h=p({appMode:s||null,identityProvider:"enterprise_sso",authUrl:n}),d=()=>{e&&(window.location.href=e)},i=()=>{r&&(window.location.href=r)},f=()=>{c&&(window.location.href=c)},w=()=>{h&&(window.location.href=h)},I=a&&a.length>0&&a.includes("github"),L=a&&a.length>0&&a.includes("gitlab"),R=a&&a.length>0&&a.includes("bitbucket"),M=a&&a.length>0&&a.includes("enterprise_sso"),N=!a||a.length===0;return t.jsx(S,{children:t.jsxs(O,{className:"border border-tertiary",children:[t.jsx(j,{width:68,height:46}),t.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:t.jsx("h1",{className:"text-2xl font-bold",children:o(l.AUTH$SIGN_IN_WITH_IDENTITY_PROVIDER)})}),t.jsx("div",{className:"flex flex-col gap-3 w-full",children:N?t.jsx("div",{className:"text-center p-4 text-muted-foreground",children:o(l.AUTH$NO_PROVIDERS_CONFIGURED)}):t.jsxs(t.Fragment,{children:[I&&t.jsx(_,{type:"button",variant:"primary",onClick:d,className:"w-full font-semibold",startContent:t.jsx(Ne,{width:20,height:20}),children:o(l.GITHUB$CONNECT_TO_GITHUB)}),L&&t.jsx(_,{type:"button",variant:"primary",onClick:i,className:"w-full font-semibold",startContent:t.jsx(Ae,{width:20,height:20}),children:o(l.GITLAB$CONNECT_TO_GITLAB)}),R&&t.jsx(_,{type:"button",variant:"primary",onClick:f,className:"w-full font-semibold",startContent:t.jsx(we,{width:20,height:20}),children:o(l.BITBUCKET$CONNECT_TO_BITBUCKET)}),M&&t.jsx(_,{type:"button",variant:"primary",onClick:w,className:"w-full font-semibold",children:o(l.ENTERPRISE_SSO$CONNECT_TO_ENTERPRISE_SSO)})]})}),t.jsxs("p",{className:"mt-4 text-xs text-center text-muted-foreground","data-testid":"auth-modal-terms-of-service",children:[o(l.AUTH$BY_SIGNING_UP_YOU_AGREE_TO_OUR)," ",t.jsx("a",{href:"https://www.all-hands.dev/tos",target:"_blank",className:"underline hover:text-primary",rel:"noopener noreferrer",children:o(l.COMMON$TERMS_OF_SERVICE)})," ",o(l.COMMON$AND)," ",t.jsx("a",{href:"https://www.all-hands.dev/privacy",target:"_blank",className:"underline hover:text-primary",rel:"noopener noreferrer",children:o(l.COMMON$PRIVACY_POLICY)}),"."]})]})})}function ye(){const{t:e}=g();return t.jsx(S,{children:t.jsxs(O,{className:"border border-tertiary",children:[t.jsx(j,{width:68,height:46}),t.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:t.jsx("h1",{className:"text-2xl font-bold",children:e(l.AUTH$LOGGING_BACK_IN)})})]})})}function be({onClose:e}){const{t:s}=g(),{mutate:n}=H(),a=async o=>{o.preventDefault();const c=new FormData(o.currentTarget).get("analytics")==="on";n({user_consents_to_analytics:c},{onSuccess:()=>{k(c),e()}})};return t.jsx(S,{children:t.jsx("form",{"data-testid":"user-capture-consent-form",onSubmit:a,className:"flex flex-col gap-2",children:t.jsxs(O,{className:"border border-tertiary",children:[t.jsx(se,{title:s(l.ANALYTICS$TITLE)}),t.jsx(ne,{children:s(l.ANALYTICS$DESCRIPTION)}),t.jsxs("label",{className:"flex gap-2 items-center self-start text-sm",children:[t.jsx("input",{name:"analytics",type:"checkbox",defaultChecked:!0}),s(l.ANALYTICS$SEND_ANONYMOUS_DATA)]}),t.jsx(_,{testId:"confirm-preferences",type:"submit",variant:"primary",className:"w-full",children:s(l.ANALYTICS$CONFIRM_PREFERENCES)})]})})})}const Ce=()=>{const{mutate:e}=H();return{migrateUserConsent:u.useCallback(async n=>{const a=localStorage.getItem("analytics-consent");a&&(n?.handleAnalyticsWasPresentInLocalStorage(),await e({user_consents_to_analytics:a==="true"},{onSuccess:()=>{k(a==="true")}}),localStorage.removeItem("analytics-consent"))},[])}};function Se(){const{t:e}=g(),{mutate:s,isPending:n}=te({mutationFn:oe.createBillingSessionResponse,onSuccess:a=>{window.location.href=a},onError:()=>{ie(e(l.BILLING$ERROR_WHILE_CREATING_SESSION))}});return t.jsx(S,{children:t.jsxs(O,{className:"border border-tertiary",children:[t.jsx(j,{width:68,height:46}),t.jsxs("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:[t.jsx("h1",{className:"text-2xl font-bold",children:e(l.BILLING$YOUVE_GOT_50)}),t.jsx("p",{children:t.jsx(le,{i18nKey:"BILLING$CLAIM_YOUR_50",components:{b:t.jsx("strong",{})}})})]}),t.jsx(_,{testId:"proceed-to-stripe-button",type:"submit",variant:"primary",className:"w-full",isDisabled:n,onClick:s,children:e(l.BILLING$PROCEED_TO_STRIPE)})]})})}const Oe=()=>{const{data:e,isLoading:s}=A(),{data:n,isLoading:a}=U(),o=Y(),r=p({appMode:e?.APP_MODE||null,identityProvider:"github",authUrl:e?.AUTH_URL}),c=p({appMode:e?.APP_MODE||null,identityProvider:"gitlab",authUrl:e?.AUTH_URL}),h=p({appMode:e?.APP_MODE||null,identityProvider:"bitbucket",authUrl:e?.AUTH_URL}),d=p({appMode:e?.APP_MODE||null,identityProvider:"enterprise_sso",authUrl:e?.AUTH_URL});m.useEffect(()=>{if(e?.APP_MODE!=="saas"||s||a||n||!o)return;let i=null;if(o===E.GITHUB?i=r:o===E.GITLAB?i=c:o===E.BITBUCKET?i=h:o===E.ENTERPRISE_SSO&&(i=d),i){const f=new URL(i);f.searchParams.append("login_method",o),window.location.href=f.toString()}},[e?.APP_MODE,n,s,a,o,r,c,h,d])},Le=()=>{const e=C(),{data:s,isLoading:n}=U(),{data:a}=A(),o=P();m.useEffect(()=>{if(a?.APP_MODE!=="saas"||n||!s)return;const r=new URLSearchParams(e.search),c=r.get("login_method");if(Object.values(E).includes(c)){ce(c),r.delete("login_method");const h=`${e.pathname}${r.toString()?`?${r.toString()}`:""}`;o(h,{replace:!0})}},[s,n,e.search,a?.APP_MODE])};class Re{static async getUser(){const s=await ue.get("/api/user/info"),{data:n}=s;return{id:n.id,login:n.login,avatar_url:n.avatar_url,company:n.company,name:n.name,email:n.email}}}const Me=()=>{const{data:e}=A(),s=me(),n=q({queryKey:["user"],queryFn:Re.getUser,enabled:s,retry:!1,staleTime:1e3*60*5,gcTime:1e3*60*15});return u.useEffect(()=>{n.data&&de.identify(n.data.login,{company:n.data.company,name:n.data.name,email:n.data.email,user:n.data.login,mode:e?.APP_MODE||"oss"})},[n.data]),n},$="6bac7145b4ee6ec";class Te{initialized=!1;scriptLoaded=!1;async init(){if(!this.initialized)try{await this.loadScript(),window.Reo&&(window.Reo.init({clientID:$}),this.initialized=!0)}catch(s){console.error("Failed to initialize Reo.dev tracking:",s)}}loadScript(){return new Promise((s,n)=>{if(this.scriptLoaded){s();return}const a=document.createElement("script");a.src=`https://static.reo.dev/${$}/reo.js`,a.defer=!0,a.onload=()=>{this.scriptLoaded=!0,s()},a.onerror=()=>{n(new Error("Failed to load Reo.dev script"))},document.head.appendChild(a)})}identify(s){if(!this.initialized){console.warn("Reo.dev not initialized. Call init() first.");return}try{window.Reo&&window.Reo.identify(s)}catch(n){console.error("Failed to identify user in Reo.dev:",n)}}isInitialized(){return this.initialized}}const b=new Te,ve=e=>{switch(e){case E.GITHUB:return"github";case E.ENTERPRISE_SSO:return"email";default:return"email"}},Pe=e=>{if(e)return[{username:e,type:"email"}]},Ue=e=>{if(!e)return{};const[s,...n]=e.split(" ");return s?{firstname:s,lastname:n.length>0?n.join(" "):void 0}:{}},je=(e,s)=>{const{firstname:n,lastname:a}=Ue(e.name);return{username:e.login,type:ve(s),other_identities:Pe(e.email),firstname:n,lastname:a,company:e.company||void 0}},De=()=>{const{data:e}=A(),{data:s}=Me(),[n,a]=u.useState(!1);u.useEffect(()=>{(async()=>{e?.APP_MODE==="saas"&&!b.isInitialized()&&await b.init()})()},[e?.APP_MODE]),u.useEffect(()=>{if(e?.APP_MODE!=="saas"||!s||n||!b.isInitialized())return;const o=Y();if(!o)return;const r=je(s,o);b.identify(r),a(!0)},[e?.APP_MODE,s,n])};function Be({children:e}){const{data:s,isLoading:n}=F(),a=P(),{pathname:o}=C();return u.useEffect(()=>{n||s?.EMAIL_VERIFIED===!1&&o!=="/settings/user"&&a("/settings/user",{replace:!0})},[s?.EMAIL_VERIFIED,o,a,n]),e}function Ge({startTime:e}){const{t:s}=g(),[n,a]=he("maintenance_banner_dismissed_at",null),{pathname:o}=C(),c=(d=>{try{let i;if(d.includes("T")&&(d.includes("-05:00")||d.includes("-04:00")||d.includes("EST")||d.includes("EDT")))i=new Date(d);else{const f=new Date(d);if(Number.isNaN(f.getTime()))throw new Error("Invalid date");i=f}return i.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"})}catch(i){return console.warn("Failed to parse maintenance time:",i),d}})(e);return m.useMemo(()=>Number.isNaN(new Date(e).getTime())?!1:n!==c,[n,e])?t.jsxs("div",{"data-testid":"maintenance-banner",className:v("bg-primary text-[#0D0F11] p-4 rounded","flex flex-row items-center justify-between m-1",o==="/"&&"mt-3 mr-3"),children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(fe,{className:"text-white align-middle"})}),t.jsx("div",{className:"ml-3",children:t.jsx("p",{className:"text-sm font-medium",children:s("MAINTENANCE$SCHEDULED_MESSAGE",{time:c})})})]}),t.jsx("button",{type:"button","data-testid":"dismiss-button",onClick:()=>a(c),className:v("bg-[#0D0F11] rounded-full w-5 h-5 flex items-center justify-center cursor-pointer"),children:t.jsx(pe,{})})]}):null}const xt=K(function(){const s=Q(),{t:n}=g();return X(s)?t.jsxs("div",{children:[t.jsx("h1",{children:s.status}),t.jsx("p",{children:s.statusText}),t.jsx("pre",{children:s.data instanceof Object?JSON.stringify(s.data):s.data})]}):s instanceof Error?t.jsxs("div",{children:[t.jsx("h1",{children:n(l.ERROR$GENERIC)}),t.jsx("pre",{children:s.message})]}):t.jsx("div",{children:t.jsx("h1",{children:n(l.ERROR$UNKNOWN)})})}),_t=Z(function(){const s=P(),{pathname:n}=C(),a=n.startsWith("/demo"),o=ee(),{data:r}=F(),{error:c}=ae(),{migrateUserConsent:h}=Ce(),{t:d}=g(),i=A(),{data:f,isFetching:w,isError:I}=U(),L=_e({appMode:i.data?.APP_MODE||null,gitHubClientId:i.data?.GITHUB_CLIENT_ID||null,authUrl:i.data?.AUTH_URL}),R=o?null:L,[M,N]=u.useState(!1);Oe(),Le(),De(),u.useEffect(()=>{!o&&r?.LANGUAGE&&ge.changeLanguage(r.LANGUAGE)},[r?.LANGUAGE,o]),u.useEffect(()=>{if(!o){const y=r?.USER_CONSENTS_TO_ANALYTICS===null;N(y)}},[r,o]),u.useEffect(()=>{o||h({handleAnalyticsWasPresentInLocalStorage:()=>{N(!1)}})},[o]),u.useEffect(()=>{r?.IS_NEW_USER&&i.data?.APP_MODE==="saas"&&re(d(l.BILLING$YOURE_IN))},[r?.IS_NEW_USER,i.data?.APP_MODE]),u.useEffect(()=>{!o&&c?.status===402&&n!=="/"&&s("/")},[c?.status,n,o]);const x=u.useCallback(()=>typeof window<"u"&&window.localStorage?localStorage.getItem(G.LOGIN_METHOD)!==null:!1,[]),[D,T]=u.useState(x());u.useEffect(()=>{const y=W=>{W.key===G.LOGIN_METHOD&&T(x())},B=()=>{T(x())};return window.addEventListener("storage",y),window.addEventListener("focus",B),()=>{window.removeEventListener("storage",y),window.removeEventListener("focus",B)}},[x]),u.useEffect(()=>{T(x())},[f,x]);const V=!f&&!I&&!w&&!o&&!a&&i.data?.APP_MODE==="saas"&&!D,z=!f&&!I&&!w&&!o&&!a&&i.data?.APP_MODE==="saas"&&D;return t.jsxs("div",{"data-testid":"root-layout",className:v("h-screen lg:min-w-[1024px] flex flex-col md:flex-row bg-base",n==="/"?"p-0":"p-0 md:p-3 md:pl-0",Ee()&&"overflow-hidden"),children:[t.jsxs("div",{className:"flex flex-col w-full h-[calc(100%-50px)] md:h-full gap-3",children:[i.data?.MAINTENANCE&&t.jsx(Ge,{startTime:i.data.MAINTENANCE.startTime}),t.jsx("div",{id:"root-outlet",className:"flex-1 relative overflow-auto custom-scrollbar",children:t.jsx(Be,{children:t.jsx(J,{})})})]}),V&&t.jsx(Ie,{githubAuthUrl:R,appMode:i.data?.APP_MODE,providersConfigured:i.data?.PROVIDERS_CONFIGURED,authUrl:i.data?.AUTH_URL}),z&&t.jsx(ye,{}),i.data?.APP_MODE==="oss"&&M&&!a&&t.jsx(be,{onClose:()=>{N(!1)}}),i.data?.FEATURE_FLAGS.ENABLE_BILLING&&i.data?.APP_MODE==="saas"&&r?.IS_NEW_USER&&!a&&t.jsx(Se,{})]})});export{xt as ErrorBoundary,_t as default};
