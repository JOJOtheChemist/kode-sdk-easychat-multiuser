import{r as d,p as e,z as k,v as b,A,w as I,R}from"./chunk-NISHYRIK-CKdEls7F.js";import{u as m}from"./useTranslation-DONB_giz.js";import{T as S,c as w}from"./typography-dnvkoiv9.js";import{a as $,b as L,c as P}from"./index-BDUzCKOA.js";import{u as E,r as F,n as H,o as G}from"./open-hands-axios-BIuoB8bl.js";import{u as D,a as _,G as U,C as V}from"./git-provider-icon-Db_Bl_5f.js";import{c as f,g as B,a as K,b as q}from"./utils-BVnsmU2z.js";import{a as W}from"./use-config-DZPclKuv.js";import{u as z}from"./use-should-show-user-features-Nu8pXKlT.js";import{I as u}from"./declaration-B9eIPmUJ.js";import{B as Q}from"./brand-button-BQs8JWFf.js";import{S as Z,a as J}from"./repo-forked-BC1XV35P.js";import{T as X}from"./tooltip-button-DdCqtqn-.js";import{u as Y}from"./useInfiniteQuery-D7tvzYjd.js";import{u as ee}from"./use-is-authed-Dg_tgDAm.js";import"./module-CWLbpm_7.js";import"./bundle-mjs-0JNfDbnS.js";import"./option-service.api-CTPg1Fmy.js";import"./use-user-providers-P0hmd5MI.js";import"./use-settings-B2QUSrrJ.js";import"./preload-helper-BXl3LOEh.js";import"./index-JAudiiL9.js";import"./chunk-TX3FPB7D-DZsJI2yo.js";import"./index-CX-90vHk.js";import"./infiniteQueryBehavior-D7Qz1qlw.js";function se(s,t){const n=E(t);return te({filters:{...s,status:"pending"}},n).length}function v(s,t){return s.findAll(t.filters).map(n=>t.select?t.select(n):n.state)}function te(s={},t){const n=E(t).getMutationCache(),a=d.useRef(s),r=d.useRef(null);return r.current||(r.current=v(n,s)),d.useEffect(()=>{a.current=s}),d.useSyncExternalStore(d.useCallback(i=>n.subscribe(()=>{const l=F(r.current,v(n,a.current));r.current!==l&&(r.current=l,H.schedule(i))}),[n]),()=>r.current,()=>r.current)}function ne(){const{t:s}=m();return e.jsxs("div",{className:"w-fit flex flex-col md:flex-row items-start md:items-center justify-center gap-1 rounded-[12px] bg-[#454545] leading-5 text-white text-[15px] font-normal m-1 md:h-9.5 px-4 pb-1 md:px-[15px] md:py-0",children:[e.jsxs("span",{className:"",children:[s("HOME$GUIDE_MESSAGE_TITLE")," "]}),e.jsx("a",{href:"https://docs.all-hands.dev/usage/getting-started",target:"_blank",rel:"noopener noreferrer",children:e.jsx("span",{className:"underline",children:s("COMMON$CLICK_HERE")})})]})}function ae(){const{t:s}=m();return e.jsx("div",{className:"h-[80px] flex items-center",children:e.jsx(S.H1,{children:s("HOME$LETS_START_BUILDING")})})}function re(){return e.jsxs("header",{className:"flex flex-col items-center gap-12",children:[e.jsx(ne,{}),e.jsx(ae,{})]})}const T=()=>{const s=k(),t=se({mutationKey:["create-conversation"]}),n=!!s.location;return t>0||n};function le({href:s,issueNumber:t}){return e.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer","data-testid":"task-id",children:e.jsxs("span",{className:"text-xs text-[#A3A3A3] leading-4 font-normal",children:["#",t]})})}const ie=s=>({FAILING_CHECKS:s("HOME$FIX_FAILING_CHECKS"),MERGE_CONFLICTS:s("HOME$RESOLVE_MERGE_CONFLICTS"),OPEN_ISSUE:s("HOME$OPEN_ISSUE"),UNRESOLVED_COMMENTS:s("HOME$RESOLVE_UNRESOLVED_COMMENTS")});function oe({task:s}){const{setOptimisticUserMessage:t}=D(),{mutate:n}=_(),a=T(),{t:r}=m(),i=b(),l=()=>(t(r("TASK$ADDRESSING_TASK")),n({repository:{name:s.repo,gitProvider:s.git_provider},suggestedTask:s},{onSuccess:c=>{i(`/conversations/${c.conversation_id}`)}}));let o;if(s.git_provider==="gitlab"){const c=s.task_type==="OPEN_ISSUE"?"issues":"merge_requests";o=`https://gitlab.com/${s.repo}/-/${c}/${s.issue_number}`}else if(s.git_provider==="bitbucket"){const c=s.task_type==="OPEN_ISSUE"?"issues":"pull-requests";o=`https://bitbucket.org/${s.repo}/${c}/${s.issue_number}`}else{const c=s.task_type==="OPEN_ISSUE"?"issues":"pull";o=`https://github.com/${s.repo}/${c}/${s.issue_number}`}return e.jsx("button",{type:"button","data-testid":"task-launch-button",className:f("w-full p-[14px] text-left flex items-center justify-between cursor-pointer hover:bg-[#5C5D62] transition-all duration-300 rounded-lg",a&&"cursor-not-allowed"),disabled:a,onClick:l,children:e.jsxs("div",{className:"flex items-center gap-3 min-w-0 w-full",children:[e.jsx(le,{issueNumber:s.issue_number,href:o}),e.jsxs("div",{className:"flex flex-col gap-1 min-w-0 flex-1",children:[e.jsx("span",{className:"text-xs text-white leading-6 font-normal truncate",children:ie(r)[s.task_type]}),e.jsx("span",{className:"text-xs text-[#A3A3A3] leading-4 font-normal max-w-70 truncate",title:s.title,children:s.title})]})]})})}function ce({children:s}){return e.jsx("div",{className:"py-3",children:e.jsx("h3",{className:"text-xs text-white leading-6 font-normal",children:s})})}function de({title:s,tasks:t}){const n=t.length>0?t[0].git_provider:null;return e.jsxs("div",{className:"text-content-2 px-[14px]",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b-1 border-[#717888] mb-2",children:[n==="github"&&e.jsx($,{size:14}),n==="gitlab"&&e.jsx(L,{}),n==="bitbucket"&&e.jsx(P,{}),e.jsx(ce,{children:s})]}),e.jsx("ul",{className:"w-full text-sm",children:t.map(a=>e.jsx("li",{className:"w-full",children:e.jsx(oe,{task:a})},a.issue_number))})]})}class ue{static async getSuggestedTasks(){const{data:t}=await G.get("/api/user/suggested-tasks");return t}}function xe(s){const t={};for(const n of s){const a=`${n.repo}`;t[a]||(t[a]={title:a,tasks:[]}),t[a].tasks.push(n)}return Object.values(t)}const me=()=>{const s=z();return W({queryKey:["tasks"],queryFn:ue.getSuggestedTasks,select:xe,enabled:s})};function pe(){return e.jsxs("li",{className:"py-3 flex items-center pr-6",children:[e.jsx("div",{className:"h-3 w-8 skeleton !rounded-sm"}),e.jsxs("div",{className:"w-full pl-8",children:[e.jsx("div",{className:"h-3 w-24 skeleton mb-2 !rounded-sm"}),e.jsx("div",{className:f("h-3 skeleton w-3/4 !rounded-sm")})]}),e.jsx("div",{className:"h-3 w-16 skeleton !rounded-sm"})]})}function fe({items:s=3}){return e.jsxs("div",{"data-testid":"task-group-skeleton",children:[e.jsx("div",{className:"py-3 border-b border-[#717888] pt-3.5",children:e.jsx("div",{className:"h-3 w-40 skeleton !rounded-sm"})}),e.jsx("ul",{children:Array.from({length:s}).map((t,n)=>e.jsx(pe,{},n))}),e.jsx("div",{className:"w-15 h-3 skeleton !rounded-sm mb-4"})]})}function he(){return e.jsx(fe,{})}function ge({filterFor:s}){const{t}=m(),[n,a]=d.useState(!1),{data:r,isLoading:i}=me(),l=s?r?.filter(x=>x.title===s.full_name&&!!x.tasks.find(p=>p.git_provider===s.git_provider)):r,o=l&&l.length>0,c=B(l,n),g=K(l)>3,h=()=>{a(x=>!x)};return e.jsxs("section",{"data-testid":"task-suggestions",className:"flex flex-1 min-w-0 flex-col",children:[e.jsx("div",{className:f("flex items-center gap-2",!o&&"mb-[14px]"),children:e.jsx("h3",{className:"text-xs leading-4 text-white font-semibold py-[14px] pl-[14px]",children:t(u.TASKS$SUGGESTED_TASKS)})}),e.jsxs("div",{className:"flex flex-col",children:[i&&e.jsx("div",{className:"px-[14px]",children:e.jsx(he,{})}),!o&&!i&&e.jsx("span",{className:"text-xs leading-4 text-white font-medium px-[14px]",children:t(u.TASKS$NO_TASKS_AVAILABLE)}),!i&&c&&c.length>0&&e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"transition-all duration-300 ease-in-out overflow-y-auto custom-scrollbar",children:e.jsx("div",{className:"flex flex-col",children:c.map((x,p)=>e.jsx(de,{title:decodeURIComponent(x.title),tasks:x.tasks},p))})})})]}),!i&&g&&e.jsx("div",{className:"flex justify-start mt-6 mb-8 ml-[14px]",children:e.jsx("button",{type:"button",onClick:h,className:"text-xs leading-4 text-[#FAFAFA] font-normal cursor-pointer hover:underline",children:t(n?u.COMMON$VIEW_LESS:u.COMMON$VIEW_MORE)})})]})}const Ne=s=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 25 25",fill:"none",...s},d.createElement("path",{d:"M10.8696 23.3696V1.63043C10.8696 0.729971 11.5995 0 12.5 0C13.4005 0 14.1304 0.729971 14.1304 1.63043V23.3696C14.1304 24.27 13.4005 25 12.5 25C11.5995 25 10.8696 24.27 10.8696 23.3696Z",fill:"currentColor"}),d.createElement("path",{d:"M1.63043 10.8641L23.3696 10.8641C24.27 10.8641 25 11.5941 25 12.4946C25 13.395 24.27 14.125 23.3696 14.125L1.63043 14.125C0.729971 14.125 -3.93605e-08 13.395 0 12.4946C3.93605e-08 11.5941 0.729971 10.8641 1.63043 10.8641Z",fill:"currentColor"})),C=w("flex items-center",{variants:{gap:{default:"gap-[10px]"},textSize:{default:"text-base"},fontWeight:{default:"font-bold"},textColor:{default:"text-white"},lineHeight:{default:"leading-5"}},defaultVariants:{gap:"default",textSize:"default",fontWeight:"default",textColor:"default",lineHeight:"default"}});function je({icon:s,children:t,className:n="",gap:a,textSize:r,fontWeight:i,textColor:l,lineHeight:o}){return e.jsxs("div",{className:f(C({gap:a,textSize:r,fontWeight:i,textColor:l,lineHeight:o}),n),children:[s,e.jsx("span",{className:f(C({lineHeight:o,textSize:r,fontWeight:i,textColor:l}),"flex items-center"),children:t})]})}function ve(){const{t:s}=m(),t=b(),{mutate:n,isPending:a,isSuccess:r}=_(),i=T(),l=a||r||i,o=()=>{n({},{onSuccess:c=>t(`/conversations/${c.conversation_id}`)})};return e.jsxs(Q,{testId:"launch-new-conversation-button",variant:"primary",type:"button",onClick:o,isDisabled:l,className:"w-auto absolute bottom-5 left-5 right-5 font-semibold",children:[!l&&s("COMMON$NEW_CONVERSATION"),l&&s("HOME$LOADING")]})}const Ce=w("w-full flex flex-col rounded-[12px] p-[20px] border border-[#727987] bg-[#26282D] relative",{variants:{gap:{default:"gap-[10px]",large:"gap-6"},minHeight:{default:"min-h-[286px] md:min-h-auto",small:"min-h-[263.5px]"}},defaultVariants:{gap:"default",minHeight:"default"}});function be({children:s,className:t="",testId:n,gap:a,minHeight:r}){return e.jsx("div",{"data-testid":n,className:f(Ce({gap:a,minHeight:r}),t),children:s})}function Se(){const{t:s}=m();return e.jsxs(be,{children:[e.jsx(je,{icon:e.jsx(Ne,{width:17,height:14}),children:s(u.COMMON$START_FROM_SCRATCH)}),e.jsx(S.Text,{children:s(u.HOME$NEW_PROJECT_DESCRIPTION)}),e.jsx(ve,{})]})}function we(){return e.jsxs("div",{className:"flex flex-col gap-1 py-[14px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full skeleton"}),e.jsx("div",{className:"w-27 h-3 skeleton !rounded-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 skeleton !rounded-sm"}),e.jsx("div",{className:"w-30.75 max-w-30.75 h-3 skeleton !rounded-sm"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 skeleton !rounded-sm"}),e.jsx("div",{className:"w-24 max-w-24 h-3 skeleton !rounded-sm"})]})]}),e.jsx("div",{className:"w-10 h-3 skeleton !rounded-sm"})]})]})}function Ee({items:s=3}){return e.jsxs("div",{"data-testid":"recent-conversations-skeleton",children:[e.jsx("ul",{children:Array.from({length:s}).map((t,n)=>e.jsx(we,{},n))}),e.jsx("div",{className:"w-15 h-3 skeleton !rounded-sm"})]})}function _e(){return e.jsx(Ee,{})}const Te=s=>{const n=new Date().getTime()-s.getTime(),a=Math.floor(n/1e3),r=Math.floor(a/60),i=Math.floor(r/60),l=Math.floor(i/24),o=Math.floor(l/30),c=Math.floor(o/12);return a<60?`${a}s`:r<60?`${r}m`:i<24?`${i}h`:l<30?`${l}d`:o<12?`${o}mo`:`${c}y`};function ye({conversationStatus:s}){const{t}=m(),n=d.useMemo(()=>{switch(s){case"STOPPED":return"bg-[#3C3C49]";case"RUNNING":return"bg-[#1FBD53]";case"STARTING":return"bg-[#FFD43B]";case"ERROR":return"bg-[#FF684E]";default:return"bg-[#3C3C49]"}},[s]),a=t(q(s));return e.jsx(X,{tooltip:a,ariaLabel:a,placement:"right",showArrow:!0,className:"p-0 border-0 bg-transparent hover:opacity-100",tooltipClassName:"bg-[#1a1a1a] text-white text-xs shadow-lg",children:e.jsx("div",{className:f("w-1.5 h-1.5 rounded-full",n)})})}function Oe({conversation:s}){const{t}=m(),n=s.selected_repository&&s.selected_branch;return e.jsx(A,{to:`/conversations/${s.conversation_id}`,className:"block w-full rounded-lg hover:bg-[#5C5D62] transition-all duration-300 text-left",children:e.jsxs("div",{className:"flex flex-col gap-1 p-[14px] cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 pl-1",children:[e.jsx(ye,{conversationStatus:s.status}),e.jsx("span",{className:"text-xs text-white leading-6 font-normal",children:s.title})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-[#A3A3A3] leading-4 font-normal",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{gitProvider:s.git_provider}),e.jsx("span",{className:"max-w-[124px] truncate",title:s.selected_repository||"",children:s.selected_repository})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{width:12,height:12,color:"#A3A3A3"}),e.jsx("span",{className:"max-w-[124px] truncate",children:t(u.COMMON$NO_REPOSITORY)})]}),n?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{width:12,height:12,color:"#A3A3A3"}),e.jsx("span",{className:"max-w-[124px] truncate",title:s.selected_branch||"",children:s.selected_branch})]}):null]}),e.jsxs("span",{children:[Te(new Date(s.created_at||s.last_updated_at))," ",t(u.CONVERSATION$AGO)]})]})]})})}const Me=(s=20)=>{const{data:t}=ee();return Y({queryKey:["user","conversations","paginated",s],queryFn:({pageParam:n})=>V.getUserConversations(s,n),enabled:!!t,getNextPageParam:n=>n.next_page_id,initialPageParam:void 0})},ke=({hasNextPage:s,isFetchingNextPage:t,fetchNextPage:n,threshold:a=100})=>{const r=d.useRef(null),i=d.useCallback(()=>{if(!r.current||t||!s)return;const{scrollTop:l,scrollHeight:o,clientHeight:c}=r.current;l+c>=o-a&&n()},[s,t,n,a]);return d.useEffect(()=>{const l=r.current;if(l)return l.addEventListener("scroll",i),()=>{l.removeEventListener("scroll",i)}},[i]),r};function Ae(){const{t:s}=m(),[t,n]=d.useState(!1),{data:a,isFetching:r,isFetchingNextPage:i,error:l,hasNextPage:o,fetchNextPage:c}=Me(10),g=ke({hasNextPage:!!o,isFetchingNextPage:i,fetchNextPage:c,threshold:200}),h=a?.pages.flatMap(j=>j.results)??[],x=t?10:3,p=h.slice(0,x),y=h&&h.length>0,O=h&&h.length>x,N=r&&!a,M=()=>{n(!t)};return e.jsxs("section",{"data-testid":"recent-conversations",className:"flex flex-1 min-w-0 flex-col",children:[e.jsx("div",{className:f("flex items-center gap-2",!y&&"mb-[14px]"),children:e.jsx("h3",{className:"text-xs leading-4 text-white font-bold py-[14px] pl-4",children:s(u.COMMON$RECENT_CONVERSATIONS)})}),l&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full pl-4",children:e.jsx("p",{className:"text-danger",children:l.message})}),e.jsx("div",{className:"flex flex-col",children:N&&e.jsx("div",{className:"pl-4",children:e.jsx(_e,{})})}),!N&&p?.length===0&&e.jsx("span",{className:"text-xs leading-4 text-white font-medium pl-4",children:s(u.HOME$NO_RECENT_CONVERSATIONS)}),!N&&p&&p.length>0&&e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"transition-all duration-300 ease-in-out overflow-y-auto custom-scrollbar",children:e.jsx("div",{ref:g,className:"flex flex-col",children:p.map(j=>e.jsx(Oe,{conversation:j},j.conversation_id))})})}),!N&&(O||t)&&e.jsx("div",{className:"flex justify-start mt-6 mb-8 ml-4",children:e.jsx("button",{type:"button",onClick:M,className:"text-xs leading-4 text-[#FAFAFA] font-normal cursor-pointer hover:underline",children:s(t?u.COMMON$VIEW_LESS:u.COMMON$VIEW_MORE)})})]})}function Ie(){const s=R.useMemo(()=>null,[]);return e.jsxs("div",{"data-testid":"home-screen",className:"px-0 pt-4 bg-transparent h-full flex flex-col pt-[35px] overflow-y-auto rounded-xl lg:px-[42px] lg:pt-[42px] custom-scrollbar-always",children:[e.jsx(re,{}),e.jsx("div",{className:"pt-[25px] flex justify-center",children:e.jsx("div",{className:"flex flex-col gap-5 px-6 sm:max-w-full sm:min-w-full md:flex-row lg:px-0 lg:max-w-[703px] lg:min-w-[703px]","data-testid":"home-screen-new-conversation-section",children:e.jsx(Se,{})})}),e.jsx("div",{className:"pt-4 flex sm:justify-start md:justify-center",children:e.jsxs("div",{className:"flex flex-col gap-5 px-6 md:flex-row min-w-full md:max-w-full lg:px-0 lg:max-w-[703px] lg:min-w-[703px]","data-testid":"home-screen-recent-conversations-section",children:[e.jsx(Ae,{}),e.jsx(ge,{filterFor:s})]})})]})}const rs=I(Ie);export{rs as default};
