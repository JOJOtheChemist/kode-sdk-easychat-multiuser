import{p as t,w as ae,R as l}from"./chunk-NISHYRIK-CKdEls7F.js";import{u as ne}from"./use-save-settings-CJKB8nlH.js";import{u as ie,D as T}from"./use-settings-B2QUSrrJ.js";import{A as d}from"./index-at5IPRPS.js";import{B as oe}from"./brand-button-BQs8JWFf.js";import{I as le,S as g}from"./input-skeleton-BMCVBFvZ.js";import{S as m}from"./settings-input-BhOUkEtb.js";import{I as i}from"./declaration-B9eIPmUJ.js";import{S as ce}from"./settings-dropdown-input-CJWg5DfQ.js";import{u as w}from"./useTranslation-DONB_giz.js";import{h as re}from"./handle-capture-consent-DZaBHqCI.js";import{d as Se,a as ue}from"./custom-toast-handlers-fYPNAJaC.js";import{r as ge}from"./retrieve-axios-error-message-CYr77e_f.js";import{S as G}from"./switch-skeleton-CauuxplW.js";import{u as de}from"./use-config-DZPclKuv.js";import"./open-hands-axios-BIuoB8bl.js";import"./module-CWLbpm_7.js";import"./use-is-authed-Dg_tgDAm.js";import"./i18next-Lgj2Bm8L.js";import"./preload-helper-BXl3LOEh.js";import"./utils-BVnsmU2z.js";import"./bundle-mjs-0JNfDbnS.js";import"./optional-tag-SXD2PjYq.js";import"./chunk-TX3FPB7D-DZsJI2yo.js";import"./index-JAudiiL9.js";import"./useSingleSelectListState-Dp1i9X5O.js";import"./index-CX-90vHk.js";import"./chunk-MSDKUXDP-Cfu5rKGn.js";import"./index-DWiKAxKp.js";import"./option-service.api-CTPg1Fmy.js";function Ie({defaultKey:s,onChange:o,name:c}){const{t:a}=w();return t.jsx(ce,{testId:c,name:c,onInputChange:o,label:a(i.SETTINGS$LANGUAGE),items:d.map(S=>({key:S.value,label:S.label})),defaultSelectedKey:s,isClearable:!1,wrapperClassName:"w-full max-w-[680px]"})}function Te(){return t.jsxs("div",{"data-testid":"app-settings-skeleton",className:"px-11 py-9 flex flex-col gap-6",children:[t.jsx(le,{}),t.jsx(G,{}),t.jsx(G,{})]})}const L=s=>{if(!s)return null;const o=parseFloat(s);return o&&o>=1&&Number.isFinite(o)?o:null};function me(){const{t:s}=w(),{mutate:o,isPending:c}=ne(),{data:a,isLoading:S}=ie(),{data:p}=de(),[y,E]=l.useState(!1),[O,A]=l.useState(!1),[R,N]=l.useState(!1),[U,h]=l.useState(!1),[v,B]=l.useState(!1),[V,f]=l.useState(!1),[j,_]=l.useState(!1),[H,C]=l.useState(!1),M=e=>{const n=e.get("language-input")?.toString(),r=d.find(({label:I})=>I===n)?.value||T.LANGUAGE,b=e.get("enable-analytics-switch")?.toString()==="on",z=e.get("enable-sound-notifications-switch")?.toString()==="on",J=e.get("enable-proactive-conversations-switch")?.toString()==="on",Q=e.get("enable-solvability-analysis-switch")?.toString()==="on",W=e.get("max-budget-per-task-input")?.toString(),Z=L(W||""),ee=e.get("git-user-name-input")?.toString()||T.GIT_USER_NAME,te=e.get("git-user-email-input")?.toString()||T.GIT_USER_EMAIL;o({LANGUAGE:r,user_consents_to_analytics:b,ENABLE_SOUND_NOTIFICATIONS:z,ENABLE_PROACTIVE_CONVERSATION_STARTERS:J,ENABLE_SOLVABILITY_ANALYSIS:Q,MAX_BUDGET_PER_TASK:Z,GIT_USER_NAME:ee,GIT_USER_EMAIL:te},{onSuccess:()=>{re(b),ue(s(i.SETTINGS$SAVED))},onError:I=>{const se=ge(I);Se(se||s(i.ERROR$GENERIC))},onSettled:()=>{E(!1),A(!1),N(!1),h(!1),f(!1),_(!1),C(!1)}})},P=e=>{const n=d.find(({label:r})=>r===e)?.label,u=d.find(({value:r})=>r===a?.LANGUAGE)?.label;E(n!==u)},k=e=>{const n=!!a?.USER_CONSENTS_TO_ANALYTICS;A(e!==n)},$=e=>{const n=!!a?.ENABLE_SOUND_NOTIFICATIONS;N(e!==n)},D=e=>{const n=!!a?.ENABLE_PROACTIVE_CONVERSATION_STARTERS;h(e!==n)},Y=e=>{const n=!!a?.ENABLE_SOLVABILITY_ANALYSIS;B(e!==n)},F=e=>{const n=L(e),u=a?.MAX_BUDGET_PER_TASK;f(n!==u)},K=e=>{const n=a?.GIT_USER_NAME;_(e!==n)},X=e=>{const n=a?.GIT_USER_EMAIL;C(e!==n)},q=!y&&!O&&!R&&!U&&!v&&!V&&!j&&!H,x=!a||S||c;return t.jsxs("form",{"data-testid":"app-settings-screen",action:M,className:"flex flex-col h-full justify-between",children:[x&&t.jsx(Te,{}),!x&&t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(Ie,{name:"language-input",defaultKey:a.LANGUAGE,onChange:P}),t.jsx(g,{testId:"enable-analytics-switch",name:"enable-analytics-switch",defaultIsToggled:!!a.USER_CONSENTS_TO_ANALYTICS,onToggle:k,children:s(i.ANALYTICS$SEND_ANONYMOUS_DATA)}),t.jsx(g,{testId:"enable-sound-notifications-switch",name:"enable-sound-notifications-switch",defaultIsToggled:!!a.ENABLE_SOUND_NOTIFICATIONS,onToggle:$,children:s(i.SETTINGS$SOUND_NOTIFICATIONS)}),p?.APP_MODE==="saas"&&t.jsx(g,{testId:"enable-proactive-conversations-switch",name:"enable-proactive-conversations-switch",defaultIsToggled:!!a.ENABLE_PROACTIVE_CONVERSATION_STARTERS,onToggle:D,children:s(i.SETTINGS$PROACTIVE_CONVERSATION_STARTERS)}),p?.APP_MODE==="saas"&&t.jsx(g,{testId:"enable-solvability-analysis-switch",name:"enable-solvability-analysis-switch",defaultIsToggled:!!a.ENABLE_SOLVABILITY_ANALYSIS,onToggle:Y,children:s(i.SETTINGS$SOLVABILITY_ANALYSIS)}),t.jsx(m,{testId:"max-budget-per-task-input",name:"max-budget-per-task-input",type:"number",label:s(i.SETTINGS$MAX_BUDGET_PER_CONVERSATION),defaultValue:a.MAX_BUDGET_PER_TASK?.toString()||"",onChange:F,placeholder:s(i.SETTINGS$MAXIMUM_BUDGET_USD),min:1,step:1,className:"w-full max-w-[680px]"}),t.jsxs("div",{className:"border-t border-t-tertiary pt-6 mt-2",children:[t.jsx("h3",{className:"text-lg font-medium mb-2",children:s(i.SETTINGS$GIT_SETTINGS)}),t.jsx("p",{className:"text-xs mb-4",children:s(i.SETTINGS$GIT_SETTINGS_DESCRIPTION)}),t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(m,{testId:"git-user-name-input",name:"git-user-name-input",type:"text",label:s(i.SETTINGS$GIT_USERNAME),defaultValue:a.GIT_USER_NAME||"",onChange:K,placeholder:"Username for git commits",className:"w-full max-w-[680px]"}),t.jsx(m,{testId:"git-user-email-input",name:"git-user-email-input",type:"email",label:s(i.SETTINGS$GIT_EMAIL),defaultValue:a.GIT_USER_EMAIL||"",onChange:X,placeholder:"Email for git commits",className:"w-full max-w-[680px]"})]})]})]}),t.jsx("div",{className:"flex gap-6 p-6 justify-end",children:t.jsxs(oe,{testId:"submit-button",variant:"primary",type:"submit",isDisabled:c||q,children:[!c&&s("SETTINGS$SAVE_CHANGES"),c&&s("SETTINGS$SAVING")]})})]})}const Xe=ae(me);export{Xe as default};
