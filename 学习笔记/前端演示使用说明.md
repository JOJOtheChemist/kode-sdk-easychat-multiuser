# å¤šæ­¥å·¥å…·è°ƒç”¨ Web æ¼”ç¤º

## ğŸ¯ åŠŸèƒ½

å®æ—¶éªŒè¯ Kode-SDK çš„å¤šæ­¥å·¥å…·è°ƒç”¨æœºåˆ¶ï¼Œç›´è§‚å±•ç¤ºï¼š
- âœ… ç”¨æˆ·è¾“å…¥
- âœ… LLM å›å¤ï¼ˆæµå¼æ˜¾ç¤ºï¼‰
- âœ… å·¥å…·è°ƒç”¨è¿‡ç¨‹
- âœ… æ¯ä¸ªå·¥å…·çš„è¾“å…¥/è¾“å‡º
- âœ… æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd /Users/yeya/FlutterProjects/kode-sdk/kode-sdk
./start-demo.sh
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
cd /Users/yeya/FlutterProjects/kode-sdk/kode-sdk

# è®¾ç½®ç¯å¢ƒå˜é‡
export ANTHROPIC_API_KEY="ef22d69d218e4cad8ae3c15bcc77d30d.eULl6aqOo8YEDKzG"
export ANTHROPIC_BASE_URL="https://api.z.ai/api/anthropic"
export ANTHROPIC_MODEL_ID="glm-4.5-air"
export PORT=3000

# å¯åŠ¨æœåŠ¡å™¨
npx ts-node demo-server.ts
```

## ğŸ“± è®¿é—®ç•Œé¢

å¯åŠ¨æˆåŠŸåï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

```
http://localhost:3000
```

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç®€å•ä¸¤æ­¥

è¾“å…¥ï¼š
```
è®¡ç®— 15 + 8ï¼Œç„¶åä¹˜ä»¥ 2
```

é¢„æœŸæµç¨‹ï¼š
1. LLM ç†è§£ä»»åŠ¡
2. è°ƒç”¨ `calculator(add, 15, 8)` â†’ è¿”å› 23
3. ç»“æœä¼ é€’ç»™ LLM
4. è°ƒç”¨ `calculator(multiply, 23, 2)` â†’ è¿”å› 46
5. LLM ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ

### ç¤ºä¾‹ 2ï¼šä¸‰æ­¥è®¡ç®—

è¾“å…¥ï¼š
```
å…ˆç®— 30 * 4ï¼Œå†å‡å» 50ï¼Œæœ€åé™¤ä»¥ 2
```

é¢„æœŸæµç¨‹ï¼š
1. `calculator(multiply, 30, 4)` â†’ 120
2. `calculator(subtract, 120, 50)` â†’ 70
3. `calculator(divide, 70, 2)` â†’ 35

### ç¤ºä¾‹ 3ï¼šå¤æ‚è¡¨è¾¾å¼

è¾“å…¥ï¼š
```
è®¡ç®— 100 é™¤ä»¥ 5ï¼Œç„¶ååŠ ä¸Š 20ï¼Œæœ€åä¹˜ä»¥ 3
```

é¢„æœŸæµç¨‹ï¼š
1. `calculator(divide, 100, 5)` â†’ 20
2. `calculator(add, 20, 20)` â†’ 40
3. `calculator(multiply, 40, 3)` â†’ 120

## ğŸ¨ ç•Œé¢è¯´æ˜

### å·¦ä¾§ï¼šLLM å›å¤
- å®æ—¶æ˜¾ç¤º LLM çš„æ–‡æœ¬è¾“å‡º
- æµå¼æ˜¾ç¤ºï¼Œé€å­—å‘ˆç°

### å³ä¾§ï¼šå·¥å…·è°ƒç”¨
- æ˜¾ç¤ºæ¯ä¸ªå·¥å…·è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯
- åŒ…æ‹¬ï¼š
  - å·¥å…·åç§°
  - è¾“å…¥å‚æ•°
  - è¾“å‡ºç»“æœ
  - æ‰§è¡Œæ—¶é—´

### åº•éƒ¨ï¼šçŠ¶æ€æ 
- è¿æ¥çŠ¶æ€ï¼ˆç»¿ç‚¹è¡¨ç¤ºæ´»è·ƒï¼‰
- å·¥å…·è°ƒç”¨æ¬¡æ•°
- å½“å‰æ¨¡å‹

## ğŸ“Š è§‚å¯Ÿé‡ç‚¹

### éªŒè¯ç›®æ ‡

é€šè¿‡ç•Œé¢å¯ä»¥æ¸…æ™°çœ‹åˆ°ï¼š

1. **å·¥å…·è°ƒç”¨é¡ºåº** - æŒ‰ç…§é€»è¾‘ä¾æ¬¡è°ƒç”¨
2. **ç»“æœä¼ é€’** - æ¯ä¸ªå·¥å…·çš„ç»“æœéƒ½è¢«ä¸‹ä¸€ä¸ªå·¥å…·ä½¿ç”¨
3. **LLM å†³ç­–** - LLM åŸºäºå‰ä¸€ä¸ªç»“æœå†³å®šä¸‹ä¸€æ­¥
4. **å®Œæ•´é“¾æ¡** - ä»å¼€å§‹åˆ°ç»“æŸçš„å®Œæ•´æµç¨‹

### å…³é”®ç°è±¡

âœ… **æˆåŠŸçš„æ ‡å¿—**ï¼š
- å¤šä¸ªå·¥å…·è¢«ä¾æ¬¡è°ƒç”¨
- åé¢å·¥å…·çš„è¾“å…¥åŒ…å«å‰é¢å·¥å…·çš„è¾“å‡º
- LLM çš„æœ€ç»ˆç­”æ¡ˆæ•´åˆäº†æ‰€æœ‰ç»“æœ

âŒ **å¤±è´¥çš„æ ‡å¿—**ï¼š
- åªè°ƒç”¨äº†ä¸€ä¸ªå·¥å…·å°±ç»“æŸ
- å·¥å…·è°ƒç”¨é¡ºåºé”™è¯¯
- æœ€ç»ˆç­”æ¡ˆä¸å®Œæ•´

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯ï¼ˆdemo-server.tsï¼‰

```typescript
// SSE æµå¼å“åº”
app.post('/api/chat', async (req, res) => {
  // è®¾ç½® SSE å“åº”å¤´
  res.setHeader('Content-Type', 'text/event-stream');
  
  // ç›‘å¬ Agent äº‹ä»¶
  agent.on('tool_executed', (event) => {
    // å‘é€å·¥å…·æ‰§è¡Œç»“æœ
    sendEvent('tool', { ...event });
  });
  
  // è®¢é˜… progress æµ
  for await (const event of agent.subscribe(['progress'])) {
    // æµå¼å‘é€æ–‡æœ¬å’Œå·¥å…·äº‹ä»¶
  }
});
```

### å‰ç«¯ï¼ˆindex.htmlï¼‰

```javascript
// EventSource æ¥æ”¶ SSE
const response = await fetch('/api/chat', {
  method: 'POST',
  body: JSON.stringify({ message })
});

const reader = response.body.getReader();
// å®æ—¶å¤„ç†æµå¼æ•°æ®
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  
  // è§£æ SSE äº‹ä»¶
  handleEvent(eventType, data);
}
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æœåŠ¡å™¨å¯åŠ¨å¤±è´¥

**æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f nohup.out
```

**è§£å†³**ï¼š
```bash
# ä½¿ç”¨å…¶ä»–ç«¯å£
PORT=3001 ./start-demo.sh
```

### é—®é¢˜ 2: API Key æ— æ•ˆ

**æ£€æŸ¥**ï¼š
```bash
curl http://localhost:3000/api/health
```

**è§£å†³**ï¼š
```bash
# é‡æ–°è®¾ç½®ç¯å¢ƒå˜é‡
export ANTHROPIC_API_KEY="your-valid-key"
```

### é—®é¢˜ 3: å·¥å…·è°ƒç”¨å¤±è´¥

**æ£€æŸ¥**ï¼šæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’ŒæœåŠ¡å™¨æ—¥å¿—

**è§£å†³**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- éªŒè¯ API Key
- æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯

## ğŸ“ æ–‡ä»¶ç»“æ„

```
kode-sdk/
â”œâ”€â”€ demo-server.ts          # åç«¯æœåŠ¡å™¨
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html          # å‰ç«¯ç•Œé¢
â”œâ”€â”€ start-demo.sh           # å¯åŠ¨è„šæœ¬
â””â”€â”€ examples/
    â””â”€â”€ shared/
        â””â”€â”€ runtime.ts      # è¿è¡Œæ—¶é…ç½®
```

## ğŸ“ å­¦ä¹ è¦ç‚¹

### æ ¸å¿ƒæœºåˆ¶éªŒè¯

é€šè¿‡è¿™ä¸ªæ¼”ç¤ºå¯ä»¥ç›´è§‚ç†è§£ï¼š

1. **å·¥å…·ç»“æœä¼ é€’**
   - æ¯ä¸ªå·¥å…·æ‰§è¡Œå®Œæˆå
   - ç»“æœä»¥ `user` è§’è‰²è¿½åŠ åˆ° `messages`
   - ä¸‹ä¸€è½® `runStep()` å°†å®Œæ•´ messages å‘é€ç»™ LLM

2. **è‡ªåŠ¨å¾ªç¯**
   - `ensureProcessing()` è§¦å‘ä¸‹ä¸€è½®
   - æ— éœ€æ‰‹åŠ¨æ§åˆ¶
   - è‡ªåŠ¨æŒç»­ç›´åˆ°å®Œæˆ

3. **æµå¼å“åº”**
   - æ–‡æœ¬é€å­—æ˜¾ç¤º
   - å·¥å…·è°ƒç”¨å®æ—¶æ›´æ–°
   - ç”¨æˆ·ä½“éªŒæµç•…

### ä¸æ–‡æ¡£å¯¹ç…§

```typescript
// agent.ts:950-962
const outcomes = await this.executeTools(toolBlocks);
if (outcomes.length > 0) {
  // 1. ç»“æœè¿½åŠ åˆ°æ¶ˆæ¯å†å²
  this.messages.push({ role: 'user', content: outcomes });
  
  // 2. è§¦å‘ä¸‹ä¸€è½®å¤„ç†
  this.ensureProcessing();
  return;
}
```

åœ¨ç•Œé¢ä¸Šå¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹çš„å®æ—¶å‘ç”Ÿï¼

## ğŸ’¡ æ‰©å±•å»ºè®®

### æ·»åŠ æ›´å¤šå·¥å…·

```typescript
// åœ¨ demo-server.ts ä¸­æ·»åŠ 
const timeTool = defineTool({
  name: 'get_time',
  description: 'è·å–å½“å‰æ—¶é—´',
  // ...
});
```

### è‡ªå®šä¹‰ç•Œé¢

ä¿®æ”¹ `public/index.html`ï¼š
- è°ƒæ•´é¢œè‰²ä¸»é¢˜
- æ·»åŠ åŠ¨ç”»æ•ˆæœ
- å¢åŠ ç»Ÿè®¡å›¾è¡¨

### æŒä¹…åŒ–å¯¹è¯

```typescript
// ä¿å­˜å¯¹è¯å†å²
const history = await agent.getMessages();
localStorage.setItem('chat-history', JSON.stringify(history));
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æˆåŠŸéªŒè¯-å¤šè½®å·¥å…·è°ƒç”¨.md](./æˆåŠŸéªŒè¯-å¤šè½®å·¥å…·è°ƒç”¨.md) - éªŒè¯æ€»ç»“
- [01å·¥å…·æ‰§è¡Œä¸äº‹ä»¶æµ.md](./01å·¥å…·æ‰§è¡Œä¸äº‹ä»¶æµ.md) - æ ¸å¿ƒæœºåˆ¶
- [Z.AI-GLMé…ç½®è¯´æ˜.md](./Z.AI-GLMé…ç½®è¯´æ˜.md) - API é…ç½®

---

**åˆ›å»ºæ—¶é—´**: 2025-10-16  
**ç«¯å£**: 3000  
**çŠ¶æ€**: âœ… å¯ç”¨

ğŸ‰ **å¼€å§‹ä½“éªŒå¤šæ­¥å·¥å…·è°ƒç”¨å§ï¼**

