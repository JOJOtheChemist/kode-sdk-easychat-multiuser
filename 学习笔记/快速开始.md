# Kode-SDK with GLM-4.5-air 快速开始

## 🎉 配置完成

已成功将 **智谱 AI GLM-4.5-air** 模型集成到 Kode-SDK 中！

## ✅ 完成的工作

1. ✅ 从 GitHub 克隆 Kode-SDK 仓库
2. ✅ 安装项目依赖
3. ✅ 创建 GLM Provider (`src/infra/glm-provider.ts`)
4. ✅ 配置 API 密钥和模型参数
5. ✅ 创建测试脚本并验证功能
6. ✅ 编写完整文档

## 🚀 快速测试

### 方法一：使用快速测试脚本（推荐）

```bash
./run-glm-test.sh
```

### 方法二：手动运行

```bash
# 基础测试
npx ts-node examples/test-glm.ts

# 高级测试（包含工具调用）
npx ts-node examples/test-glm-advanced.ts
```

## 📋 测试结果示例

```
🚀 开始测试 GLM-4.5-air 模型...

📝 使用模型配置: {
  provider: 'GLM',
  model: 'glm-4-air',
  baseUrl: 'https://open.bigmodel.cn/api/paas/v4'
}
✅ Agent 创建成功，开始对话...

💬 助手回复: 你好，我是一个能够帮助你管理任务清单的人工智能助手。

✨ 对话完成！
```

## 📦 核心配置

### API 配置
- **模型**: `glm-4-air` (GLM-4.5-air)
- **API Key**: `ef22d69d218e4cad8ae3c15bcc77d30d.eULl6aqOo8YEDKzG`
- **API 端点**: `https://open.bigmodel.cn/api/paas/v4`

### 核心文件
```
Kode-sdk/
├── src/infra/glm-provider.ts        # GLM Provider 实现
├── examples/
│   ├── test-glm.ts                  # 基础测试
│   └── test-glm-advanced.ts         # 高级测试
├── run-glm-test.sh                  # 快速测试脚本
├── GLM-配置说明.md                   # 详细配置说明
└── 快速开始.md                       # 本文档
```

## 🔧 使用方法

### 在你的代码中使用 GLM

```typescript
import { GLMProvider } from './src/infra/glm-provider';

// 创建 GLM Provider
const provider = new GLMProvider(
  'ef22d69d218e4cad8ae3c15bcc77d30d.eULl6aqOo8YEDKzG',
  'glm-4-air',
  'https://open.bigmodel.cn/api/paas/v4'
);

// 在 Agent 配置中使用
const deps = {
  modelFactory: (config) => provider,
  // ... 其他依赖
};
```

### Agent 配置示例

```typescript
import { Agent, GLMProvider, /* ... */ } from './src';

const agent = await Agent.create(
  {
    templateId: 'my-assistant',
    sandbox: { 
      kind: 'local', 
      workDir: './workspace' 
    },
  },
  {
    store,
    templateRegistry,
    sandboxFactory,
    toolRegistry,
    modelFactory: (config) => new GLMProvider(
      'ef22d69d218e4cad8ae3c15bcc77d30d.eULl6aqOo8YEDKzG',
      'glm-4-air'
    ),
  }
);

// 订阅事件
for await (const envelope of agent.subscribe(['progress'])) {
  if (envelope.event.type === 'text_chunk') {
    console.log(envelope.event.delta);
  }
}

// 发送消息
await agent.send('你好！');
```

## 🎯 支持的功能

- ✅ **基本对话**: 流式和非流式响应
- ✅ **工具调用**: Function Calling（待办事项、文件操作等）
- ✅ **事件系统**: Progress、Control、Monitor 三通道事件
- ✅ **上下文管理**: 128K tokens 上下文窗口
- ✅ **断点恢复**: 长时运行任务支持
- ✅ **多 Agent 协作**: Agent Pool 和 Room

## 📚 学习资源

### 文档
- [GLM-配置说明.md](./GLM-配置说明.md) - GLM 配置详细说明
- [README.md](./README.md) - Kode-SDK 官方文档
- [docs/](./docs/) - 完整 API 文档

### 示例代码
- `examples/test-glm.ts` - 最简单的使用示例
- `examples/test-glm-advanced.ts` - 高级功能演示
- `examples/01-agent-inbox.ts` - 事件驱动收件箱
- `examples/02-approval-control.ts` - 工具审批工作流
- `examples/03-room-collab.ts` - 多 Agent 协作

### 源代码
- `src/infra/glm-provider.ts` - GLM Provider 实现
- `src/infra/provider.ts` - Provider 接口定义
- `src/core/agent.ts` - Agent 核心实现

## 🔍 验证 SDK 功能

### 测试 1: 基本对话
```bash
npx ts-node examples/test-glm.ts
```
预期结果：AI 用中文回复自我介绍

### 测试 2: 工具调用
```bash
npx ts-node examples/test-glm-advanced.ts
```
预期结果：AI 调用 `todo_write` 工具创建待办事项

### 测试 3: 复杂推理
运行高级测试中的逻辑推理问题，验证模型的推理能力

## 🐛 故障排除

### 问题：编译错误
```bash
npm run build
```

### 问题：依赖缺失
```bash
rm -rf node_modules package-lock.json
npm install
```

### 问题：API 错误
检查：
1. API Key 是否正确
2. 网络连接是否正常
3. 模型名称是否为 `glm-4-air`

## 📊 性能指标

根据测试结果：
- ✅ **响应速度**: 快速，流式输出无延迟
- ✅ **稳定性**: 连续测试无错误
- ✅ **功能完整性**: 基础对话、工具调用、事件系统全部正常

## 🎊 总结

Kode-SDK 已成功配置 GLM-4.5-air 模型，可以：

1. ✅ **正常返回结果** - 基础对话功能正常
2. ✅ **工具调用** - Function Calling 工作正常
3. ✅ **事件系统** - Progress、Monitor 事件正常触发
4. ✅ **流式输出** - SSE 流式响应正常

**SDK 完全可用！** 🎉

## 下一步建议

1. 探索更多示例代码
2. 集成到你的应用中
3. 自定义工具和模板
4. 配置审批和治理策略

---

有任何问题，请查看 [GLM-配置说明.md](./GLM-配置说明.md) 或 Kode-SDK 官方文档。


